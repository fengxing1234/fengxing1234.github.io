<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="人生就像是一个马尔可夫链，你的未来取决于你当下正在做的事，而无关于过去做完的事">
<meta property="og:type" content="website">
<meta property="og:title" content="冯星的博客">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="冯星的博客">
<meta property="og:description" content="人生就像是一个马尔可夫链，你的未来取决于你当下正在做的事，而无关于过去做完的事">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="冯星">
<meta property="article:tag" content="Java，Android，Flutter">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title>冯星的博客</title>
  








<meta name="generator" content="Hexo 4.2.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">冯星的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Life is like a Markov chain, your future only depends on what you are doing now, and independent of your past.</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/07/22/flutter/widget%E7%BB%84%E4%BB%B6/RotatedBox%E6%97%8B%E8%BD%AC%E7%9B%92%E5%AD%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="冯星">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="冯星的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/07/22/flutter/widget%E7%BB%84%E4%BB%B6/RotatedBox%E6%97%8B%E8%BD%AC%E7%9B%92%E5%AD%90/" itemprop="url">RotatedBox旋转盒子</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-07-22T22:39:27+08:00">
                2020-07-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/flutter/" itemprop="url" rel="index">
                    <span itemprop="name">flutter</span>
                  </a>
                </span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/flutter/widget%E7%BB%84%E4%BB%B6/" itemprop="url" rel="index">
                    <span itemprop="name">widget组件</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2020/07/22/flutter/widget%E7%BB%84%E4%BB%B6/RotatedBox%E6%97%8B%E8%BD%AC%E7%9B%92%E5%AD%90/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2020/07/22/flutter/widget%E7%BB%84%E4%BB%B6/RotatedBox%E6%97%8B%E8%BD%AC%E7%9B%92%E5%AD%90/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="RotatedBox"><a href="#RotatedBox" class="headerlink" title="RotatedBox"></a>RotatedBox</h2><p>旋转盒子</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">RotatedBox(&#123;</span><br><span class="line">    Key key,</span><br><span class="line">    <span class="meta">@required</span> <span class="keyword">this</span>.quarterTurns,<span class="comment">//旋转的次数，每次旋转的度数只能是90度的整数倍</span></span><br><span class="line">    Widget child,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>RotatedBox和Transform.rotate功能相似，它们都可以对子组件进行旋转变换，但是有一点不同：RotatedBox的变换是在layout阶段，会影响子组件的位置和大小</p>
<p>案例</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Row(</span><br><span class="line">  mainAxisAlignment: MainAxisAlignment.center,</span><br><span class="line">  children: &lt;Widget&gt;[</span><br><span class="line">    DecoratedBox(</span><br><span class="line">      decoration: BoxDecoration(color: Colors.red),</span><br><span class="line">      <span class="comment">//将Transform.rotate换成RotatedBox  </span></span><br><span class="line">      child: RotatedBox(</span><br><span class="line">        quarterTurns: <span class="number">1</span>, <span class="comment">//旋转90度(1/4圈)</span></span><br><span class="line">        child: Text(<span class="string">"Hello world"</span>),</span><br><span class="line">      ),</span><br><span class="line">    ),</span><br><span class="line">    Text(<span class="string">"你好"</span>, style: TextStyle(color: Colors.green, fontSize: <span class="number">18.0</span>),)</span><br><span class="line">  ],</span><br><span class="line">),</span><br></pre></td></tr></table></figure>

<p><img src="http://img.laomengit.com/rotatedBox1.png" alt="img"></p>
<p>由于<code>RotatedBox</code>是作用于layout阶段，所以子组件会旋转90度（而不只是绘制的内容），<code>decoration</code>会作用到子组件所占用的实际空间上，所以最终就是上图的效果</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/07/22/flutter/widget%E7%BB%84%E4%BB%B6/%E7%9F%A9%E9%98%B5%E5%8F%98%E6%8D%A2Transform%E7%B1%BBMatrix4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="冯星">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="冯星的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/07/22/flutter/widget%E7%BB%84%E4%BB%B6/%E7%9F%A9%E9%98%B5%E5%8F%98%E6%8D%A2Transform%E7%B1%BBMatrix4/" itemprop="url">矩阵变换Transform类Matrix4</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-07-22T15:18:44+08:00">
                2020-07-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/flutter/" itemprop="url" rel="index">
                    <span itemprop="name">flutter</span>
                  </a>
                </span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/flutter/widget%E7%BB%84%E4%BB%B6/" itemprop="url" rel="index">
                    <span itemprop="name">widget组件</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2020/07/22/flutter/widget%E7%BB%84%E4%BB%B6/%E7%9F%A9%E9%98%B5%E5%8F%98%E6%8D%A2Transform%E7%B1%BBMatrix4/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2020/07/22/flutter/widget%E7%BB%84%E4%BB%B6/%E7%9F%A9%E9%98%B5%E5%8F%98%E6%8D%A2Transform%E7%B1%BBMatrix4/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p> 和尚刚学习了 <strong>Transform</strong> 类，其核心部分在于矩阵变换，而矩阵变换是由 <strong>Matrix4</strong> 处理的，且无论是如何的平移旋转等操作，根本上还是一个四阶矩阵操作的；接下来和尚学习一下 <strong>Matrix4</strong> 的基本用法；</p>
<h3 id="基本构造"><a href="#基本构造" class="headerlink" title="基本构造"></a><strong>基本构造</strong></h3><h4 id="Matrix4-double-arg0-…-double-arg15"><a href="#Matrix4-double-arg0-…-double-arg15" class="headerlink" title="Matrix4(double arg0, … double arg15)"></a><strong>Matrix4(double arg0, … double arg15)</strong></h4><p> <strong>Matrix4</strong> 默认构造函数由 <strong>16</strong> 个参数，从左到右从上到下依此排列为一个四阶矩阵；</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">transform: Matrix4(<span class="number">1.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>),</span><br></pre></td></tr></table></figure>

<h4 id="Matrix4-identity"><a href="#Matrix4-identity" class="headerlink" title="Matrix4.identity()"></a><strong>Matrix4.identity()</strong></h4><p> <strong>Matrix4.identity()</strong> 会初始化一个如上的 <strong>Matrix4</strong>，可在此基础上进行其他矩阵操作；</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">transform: Matrix4.identity(),</span><br><span class="line">transform: Matrix4.identity()..rotateZ(pi / <span class="number">4</span>),</span><br></pre></td></tr></table></figure>

<p><img src="https://upload-images.jianshu.io/upload_images/4118241-bd2a9a1f88f4d6bc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png">)Matrix4.zero()</p>
<p> <strong>Matrix4.zero()</strong> 会初始化一个所有参数值为 <strong>0</strong> 的空矩阵，在此基础上设置具体的变化矩阵；查看源码所有的初始化都是从 <strong>Matrix4.zero()</strong> 开始的；</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">transform: Matrix4.zero(),</span><br><span class="line">transform: Matrix4.zero()..setIdentity(),</span><br></pre></td></tr></table></figure>

<h4 id=""><a href="#" class="headerlink" title=""></a><img src="https://upload-images.jianshu.io/upload_images/4118241-f5338c7a8bf2737d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></h4><h4 id="Matrix4-fromList"><a href="#Matrix4-fromList" class="headerlink" title="Matrix4.fromList()"></a>Matrix4.fromList()</h4><p> <strong>Matrix4.fromList()</strong> 将 <strong>List</strong> 列表中数据赋值进入 <strong>Matrix4(double arg0, … double arg15)</strong> 类似；</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">List&lt;double&gt; list = [<span class="number">1.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>];</span><br><span class="line">transform: Matrix4.fromList(list),</span><br></pre></td></tr></table></figure>

<h4 id="Matrix4-copy"><a href="#Matrix4-copy" class="headerlink" title="Matrix4.copy()"></a><strong>Matrix4.copy()</strong></h4><p> <strong>Matrix4.copy()</strong> 拷贝一个已有的 <strong>Matrix4</strong>；</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">transform: Matrix4.copy(Matrix4.identity()),</span><br></pre></td></tr></table></figure>

<h4 id="Matrix4-columns"><a href="#Matrix4-columns" class="headerlink" title="Matrix4.columns()"></a><strong>Matrix4.columns()</strong></h4><p> <strong>Matrix4.columns()</strong> 由四个 <strong>4D</strong> 列向量组成；</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'package:vector_math/vector_math_64.dart'</span> <span class="keyword">as</span> v;</span><br><span class="line"></span><br><span class="line">transform: Matrix4.columns(</span><br><span class="line">    v.Vector4(<span class="number">1.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>),</span><br><span class="line">    v.Vector4(<span class="number">0.0</span>, <span class="number">1.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>),</span><br><span class="line">    v.Vector4(<span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>, <span class="number">0.0</span>),</span><br><span class="line">    v.Vector4(<span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>)),</span><br></pre></td></tr></table></figure>

<h4 id="Matirx4-inverted"><a href="#Matirx4-inverted" class="headerlink" title="Matirx4.inverted()"></a><strong>Matirx4.inverted()</strong></h4><p> <strong>Matrix4.inverted()</strong> 为逆向矩阵，与原 <strong>Matrix4</strong> 矩阵相反(矩阵坐标沿着左对角线对称)；</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">transform: Matrix4.inverted(Matrix4.fromList(list)),</span><br></pre></td></tr></table></figure>

<p><img src="https://upload-images.jianshu.io/upload_images/4118241-e175dacdf64d04d3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<h4 id="Matrix4-outer"><a href="#Matrix4-outer" class="headerlink" title="Matrix4.outer()"></a><strong>Matrix4.outer()</strong></h4><p> <strong>Matrix4.outer()</strong> 为两个四阶矩阵的合并乘积，注意两个四阶矩阵的先后顺序决定最终合并后的矩阵数组；</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">transform: Matrix4.outer(v.Vector4(<span class="number">1.0</span>, <span class="number">1.0</span>, <span class="number">1.0</span>, <span class="number">1.20</span>), v.Vector4.identity()),</span><br><span class="line">transform: Matrix4.outer(v.Vector4.identity(), v.Vector4(<span class="number">1.0</span>, <span class="number">1.0</span>, <span class="number">1.0</span>, <span class="number">1.20</span>)),</span><br></pre></td></tr></table></figure>

<p><img src="https://upload-images.jianshu.io/upload_images/4118241-d3dc7ac48dd73d6a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<h3 id="Scale-缩放构造方法"><a href="#Scale-缩放构造方法" class="headerlink" title="Scale 缩放构造方法"></a><strong>Scale 缩放构造方法</strong></h3><h4 id="Matrix4-diagonal3"><a href="#Matrix4-diagonal3" class="headerlink" title="Matrix4.diagonal3()"></a><strong>Matrix4.diagonal3()</strong></h4><p> <strong>Matrix4.diagonal3()</strong> 通过 <strong>Vector3</strong> 设置缩放矩阵；</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">transform: Matrix4.diagonal3(v.Vector3(<span class="number">2.0</span>, <span class="number">1.0</span>, <span class="number">1.0</span>)),</span><br><span class="line">transform: Matrix4.diagonal3(v.Vector3.array([<span class="number">2.0</span>, <span class="number">2.0</span>, <span class="number">2.0</span>])),</span><br></pre></td></tr></table></figure>

<p>​      分析 <strong>Vector3</strong> 两种构造方法，三个参数分别对应 <strong>x / y /z</strong> 轴方向缩放；</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">factory Vector3(double x, double y, double z) =&gt;</span><br><span class="line">      <span class="keyword">new</span> Vector3.zero()..setValues(x, y, z);</span><br><span class="line"></span><br><span class="line">factory Vector3.array(List&lt;double&gt; array, [int offset = <span class="number">0</span>]) =&gt;</span><br><span class="line">      <span class="keyword">new</span> Vector3.zero()..copyFromArray(array, offset);</span><br></pre></td></tr></table></figure>

<p><img src="https://upload-images.jianshu.io/upload_images/4118241-fff2193496ad52f8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<h4 id="Matirx4-diagonal3Values"><a href="#Matirx4-diagonal3Values" class="headerlink" title="Matirx4.diagonal3Values()"></a><strong>Matirx4.diagonal3Values()</strong></h4><p> <strong>Matrix4.diagonal3Values()</strong> 类似于将上述构造方法提取出来，直接对三个参数进行缩放赋值；</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">transform: Matrix4.diagonal3Values(<span class="number">2.0</span>, <span class="number">1.0</span>, <span class="number">1.0</span>),</span><br></pre></td></tr></table></figure>

<p>​      分析 <strong>diagonal3Values</strong> 源码，发现 <strong>Matrix4</strong> 矩阵中坐对角线上的值分别对应 <strong>x / y / z</strong> 轴方向的缩放；</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">factory Matrix4.diagonal3Values(double x, double y, double z) =&gt;</span><br><span class="line">    <span class="keyword">new</span> Matrix4.zero()</span><br><span class="line">      .._m4storage[<span class="number">15</span>] = <span class="number">1.0</span></span><br><span class="line">      .._m4storage[<span class="number">10</span>] = z</span><br><span class="line">      .._m4storage[<span class="number">5</span>] = y</span><br><span class="line">      .._m4storage[<span class="number">0</span>] = x;</span><br></pre></td></tr></table></figure>

<p><img src="https://upload-images.jianshu.io/upload_images/4118241-8158e2702d1fef33.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<h3 id="Transform-平移构造方法"><a href="#Transform-平移构造方法" class="headerlink" title="Transform 平移构造方法"></a><strong>Transform 平移构造方法</strong></h3><h4 id="Matrix4-translation"><a href="#Matrix4-translation" class="headerlink" title="Matrix4.translation()"></a><strong>Matrix4.translation()</strong></h4><p> <strong>Matrix4.translation</strong> 同样通过 <strong>Vector3</strong> 构造方法的各参数设置矩阵平移量；水平向右为 <strong>x</strong> 轴正向，竖直向下为 <strong>y</strong> 轴正向；</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">transform: Matrix4.translation(v.Vector3(<span class="number">10.0</span>, <span class="number">10.0</span>, <span class="number">10.0</span>)),</span><br><span class="line">transform: Matrix4.translation(v.Vector3.array([<span class="number">-10.0</span>, <span class="number">-10.0</span>, <span class="number">10.0</span>])),</span><br></pre></td></tr></table></figure>

<p><img src="https://upload-images.jianshu.io/upload_images/4118241-9406610d41b87665.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<h4 id="Matrix4-translationValues"><a href="#Matrix4-translationValues" class="headerlink" title="Matrix4.translationValues()"></a><strong>Matrix4.translationValues()</strong></h4><p> <strong>Matrix4.translationValues()</strong> 将矩阵平移量直接赋值展示；</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">transform: Matrix4.translationValues(<span class="number">10.0</span>, <span class="number">10.0</span>, <span class="number">10.0</span>),</span><br></pre></td></tr></table></figure>

<p>​      分析 <strong>translationValues</strong> 源码，<strong>Matirx4</strong> 四阶矩阵中第四行前三列分别对应 <strong>x / y / z</strong> 轴方向的偏移量；</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">factory Matrix4.translationValues(double x, double y, double z) =&gt;</span><br><span class="line">    <span class="keyword">new</span> Matrix4.zero()</span><br><span class="line">      ..setIdentity()</span><br><span class="line">      ..setTranslationRaw(x, y, z);</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> setTranslationRaw(double x, double y, double z) &#123;</span><br><span class="line">  _m4storage[<span class="number">14</span>] = z;</span><br><span class="line">  _m4storage[<span class="number">13</span>] = y;</span><br><span class="line">  _m4storage[<span class="number">12</span>] = x;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://upload-images.jianshu.io/upload_images/4118241-402f0f91a58edca0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<h3 id="Rotation-旋转构造方法"><a href="#Rotation-旋转构造方法" class="headerlink" title="Rotation 旋转构造方法"></a><strong>Rotation 旋转构造方法</strong></h3><h4 id="Matrix4-rotationX"><a href="#Matrix4-rotationX" class="headerlink" title="Matrix4.rotationX()"></a><strong>Matrix4.rotationX()</strong></h4><p> <strong>Matrix4.rotationX()</strong> 沿 <strong>x</strong> 轴方向旋转；</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">transform: Matrix4.rotationX(pi / <span class="number">3</span>),</span><br></pre></td></tr></table></figure>

<p>​      分析源码，四阶矩阵中，<strong>index</strong> 为 <strong>5/6/9/10</strong> 共同操作旋转弧度；</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> setRotationX(double radians) &#123;</span><br><span class="line">    final double c = math.cos(radians);</span><br><span class="line">    final double s = math.sin(radians);</span><br><span class="line">    _m4storage[<span class="number">0</span>] = <span class="number">1.0</span>;  _m4storage[<span class="number">1</span>] = <span class="number">0.0</span>;</span><br><span class="line">    _m4storage[<span class="number">2</span>] = <span class="number">0.0</span>;  _m4storage[<span class="number">4</span>] = <span class="number">0.0</span>;</span><br><span class="line">    _m4storage[<span class="number">5</span>] = c;    _m4storage[<span class="number">6</span>] = s;</span><br><span class="line">    _m4storage[<span class="number">8</span>] = <span class="number">0.0</span>;  _m4storage[<span class="number">9</span>] = -s;</span><br><span class="line">    _m4storage[<span class="number">10</span>] = c;   _m4storage[<span class="number">3</span>] = <span class="number">0.0</span>;</span><br><span class="line">    _m4storage[<span class="number">7</span>] = <span class="number">0.0</span>;  _m4storage[<span class="number">11</span>] = <span class="number">0.0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://upload-images.jianshu.io/upload_images/4118241-bb4e5d57588aac65.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<h4 id="Matrix4-rotationY"><a href="#Matrix4-rotationY" class="headerlink" title="Matrix4.rotationY()"></a><strong>Matrix4.rotationY()</strong></h4><p> <strong>Matrix4.rotationY()</strong> 沿 <strong>y</strong> 轴方向旋转；</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">transform: Matrix4.rotationY(pi / <span class="number">3</span>),</span><br></pre></td></tr></table></figure>

<p>​      分析源码，四阶矩阵中，<strong>index</strong> 为 <strong>0/2/8/10</strong> 共同操作旋转弧度；</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> setRotationY(double radians) &#123;</span><br><span class="line">    final double c = math.cos(radians);</span><br><span class="line">    final double s = math.sin(radians);</span><br><span class="line">    _m4storage[<span class="number">0</span>] = c;    _m4storage[<span class="number">1</span>] = <span class="number">0.0</span>;</span><br><span class="line">    _m4storage[<span class="number">2</span>] = -s;   _m4storage[<span class="number">4</span>] = <span class="number">0.0</span>;</span><br><span class="line">    _m4storage[<span class="number">5</span>] = <span class="number">1.0</span>;  _m4storage[<span class="number">6</span>] = <span class="number">0.0</span>;</span><br><span class="line">    _m4storage[<span class="number">8</span>] = s;    _m4storage[<span class="number">9</span>] = <span class="number">0.0</span>;</span><br><span class="line">    _m4storage[<span class="number">10</span>] = c;   _m4storage[<span class="number">3</span>] = <span class="number">0.0</span>;</span><br><span class="line">    _m4storage[<span class="number">7</span>] = <span class="number">0.0</span>;  _m4storage[<span class="number">11</span>] = <span class="number">0.0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://upload-images.jianshu.io/upload_images/4118241-04c2be60d2729d62.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<h4 id="Matrix4-rotationZ"><a href="#Matrix4-rotationZ" class="headerlink" title="Matrix4.rotationZ()"></a><strong>Matrix4.rotationZ()</strong></h4><p> <strong>Matrix4.rotationZ()</strong> 沿 <strong>z</strong> 轴方向旋转；</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">transform: Matrix4.rotationZ(pi / <span class="number">3</span>),</span><br></pre></td></tr></table></figure>

<p>​      分析源码，四阶矩阵中，<strong>index</strong> 为 <strong>0/1/4/5</strong> 共同操作旋转弧度；</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> setRotationZ(double radians) &#123;</span><br><span class="line">    final double c = math.cos(radians);</span><br><span class="line">    final double s = math.sin(radians);</span><br><span class="line">    _m4storage[<span class="number">0</span>] = c;</span><br><span class="line">    _m4storage[<span class="number">1</span>] = s;</span><br><span class="line">    _m4storage[<span class="number">2</span>] = <span class="number">0.0</span>;   _m4storage[<span class="number">4</span>] = -s;</span><br><span class="line">    _m4storage[<span class="number">5</span>] = c;     _m4storage[<span class="number">6</span>] = <span class="number">0.0</span>;</span><br><span class="line">    _m4storage[<span class="number">8</span>] = <span class="number">0.0</span>;   _m4storage[<span class="number">9</span>] = <span class="number">0.0</span>;</span><br><span class="line">    _m4storage[<span class="number">10</span>] = <span class="number">1.0</span>;  _m4storage[<span class="number">3</span>] = <span class="number">0.0</span>;</span><br><span class="line">    _m4storage[<span class="number">7</span>] = <span class="number">0.0</span>;   _m4storage[<span class="number">11</span>] = <span class="number">0.0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://upload-images.jianshu.io/upload_images/4118241-cb30be9ef0cd5a5c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<h3 id="Skew-斜切"><a href="#Skew-斜切" class="headerlink" title="Skew 斜切"></a><strong>Skew 斜切</strong></h3><h4 id="Matrix4-skewX"><a href="#Matrix4-skewX" class="headerlink" title="Matrix4.skewX()"></a><strong>Matrix4.skewX()</strong></h4><p>​      上一篇博客稍稍介绍过，<strong>skewX()</strong> 是沿 <strong>x</strong> 轴方向斜切；</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">transform: Matrix4.skewX(pi / <span class="number">6</span>),</span><br></pre></td></tr></table></figure>

<p>​      分析源码，四阶矩阵中，第二行第一列元素对应斜切值，即三角函数中 <strong>tan</strong>；</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">factory Matrix4.skewX(double alpha) &#123;</span><br><span class="line">    final Matrix4 m = <span class="keyword">new</span> Matrix4.identity();</span><br><span class="line">    m._m4storage[<span class="number">4</span>] = math.tan(alpha);</span><br><span class="line">    <span class="keyword">return</span> m;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://upload-images.jianshu.io/upload_images/4118241-b5f1a24e22c5147a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<h4 id="Matrix4-skewY"><a href="#Matrix4-skewY" class="headerlink" title="Matrix4.skewY()"></a><strong>Matrix4.skewY()</strong></h4><p> <strong>skewY()</strong> 是沿 <strong>y</strong> 轴方向斜切；</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">transform: Matrix4.skewY(pi / <span class="number">6</span>),</span><br></pre></td></tr></table></figure>

<p>​      分析源码，四阶矩阵中，第一行第二列元素对应斜切值，即三角函数中 <strong>tan</strong>；</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">factory Matrix4.skewY(double beta) &#123;</span><br><span class="line">    final Matrix4 m = <span class="keyword">new</span> Matrix4.identity();</span><br><span class="line">    m._m4storage[<span class="number">1</span>] = math.tan(beta);</span><br><span class="line">    <span class="keyword">return</span> m;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://upload-images.jianshu.io/upload_images/4118241-ec0812ef169da235.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<h4 id="Matrix4-skew"><a href="#Matrix4-skew" class="headerlink" title="Matrix4.skew()"></a><strong>Matrix4.skew()</strong></h4><p> <strong>skew()</strong> 是沿 <strong>x / y</strong> 轴方向斜切；</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">transform: Matrix4.skew(pi / <span class="number">6</span>, pi / <span class="number">6</span>),</span><br></pre></td></tr></table></figure>

<p>​      分析源码，四阶矩阵中，将上述两个元素结合展示效果；</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">factory Matrix4.skew(double alpha, double beta) &#123;</span><br><span class="line">    final Matrix4 m = <span class="keyword">new</span> Matrix4.identity();</span><br><span class="line">    m._m4storage[<span class="number">1</span>] = math.tan(beta);</span><br><span class="line">    m._m4storage[<span class="number">4</span>] = math.tan(alpha);</span><br><span class="line">    <span class="keyword">return</span> m;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://upload-images.jianshu.io/upload_images/4118241-f34d93e4968df09c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<h3 id="组合构造"><a href="#组合构造" class="headerlink" title="组合构造"></a><strong>组合构造</strong></h3><h4 id="Matrix4-compose"><a href="#Matrix4-compose" class="headerlink" title="Matrix4.compose()"></a><strong>Matrix4.compose()</strong></h4><p> <strong>Matrix4.compose()</strong> 可以将平移/旋转/缩放共同组合操作绘制；</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">transform: Matrix4.compose(v.Vector3(<span class="number">10.0</span>, <span class="number">10.0</span>, <span class="number">10.0</span>), v.Quaternion.random(math.Random(<span class="number">10</span>)), v.Vector3(<span class="number">1.5</span>, <span class="number">1.0</span>, <span class="number">1.0</span>)),</span><br></pre></td></tr></table></figure>

<p>​      分析源码，三个参数分别对应平移量/旋转量/缩放量；旋转量用到了欧拉旋转，和尚还不是很理解，只是在测试中用了 <strong>v.Quaternion.random()</strong> 的一个构造方法，还有待深入探索；</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">factory Matrix4.compose(</span><br><span class="line">        Vector3 translation, Quaternion rotation, Vector3 scale) =&gt;</span><br><span class="line">    <span class="keyword">new</span> Matrix4.zero()</span><br><span class="line">      ..setFromTranslationRotationScale(translation, rotation, scale);</span><br></pre></td></tr></table></figure>

<p><img src="https://upload-images.jianshu.io/upload_images/4118241-dafa28c1288dcaab.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<hr>
<p> <strong>Matirx4</strong> 涉及的范围很广泛，还有很多方法和尚没有研究到，只是尝试了一些常用的构造方法，若有错误的地方请多多指导！</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/07/22/flutter/widget%E7%BB%84%E4%BB%B6/%E7%9F%A9%E9%98%B5%E5%8F%98%E6%8D%A2Transform%E7%B1%BB%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="冯星">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="冯星的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/07/22/flutter/widget%E7%BB%84%E4%BB%B6/%E7%9F%A9%E9%98%B5%E5%8F%98%E6%8D%A2Transform%E7%B1%BB%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/" itemprop="url">矩阵变换Transform类基本使用</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-07-22T14:43:29+08:00">
                2020-07-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/flutter/" itemprop="url" rel="index">
                    <span itemprop="name">flutter</span>
                  </a>
                </span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/flutter/widget%E7%BB%84%E4%BB%B6/" itemprop="url" rel="index">
                    <span itemprop="name">widget组件</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2020/07/22/flutter/widget%E7%BB%84%E4%BB%B6/%E7%9F%A9%E9%98%B5%E5%8F%98%E6%8D%A2Transform%E7%B1%BB%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2020/07/22/flutter/widget%E7%BB%84%E4%BB%B6/%E7%9F%A9%E9%98%B5%E5%8F%98%E6%8D%A2Transform%E7%B1%BB%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>和尚在学习矩阵变换时需要用到 <strong>Transform</strong> 类，可以实现子 <strong>Widget</strong> 的 <strong>scale 缩放 / translate 平移 / rotate 旋转 / skew 斜切</strong> 等效果，对应于 <strong>Canvas</strong> 绘制过程中的矩阵变换等；和尚今对此进行初步整理；</p>
<h3 id="一、scale-缩放"><a href="#一、scale-缩放" class="headerlink" title="一、scale 缩放"></a>一、scale 缩放</h3><p> <strong>scale 缩放</strong> 可以通过 <strong>Transform</strong> 提供的构造方法或 <strong>Matrix4</strong> 矩阵变化来实现；</p>
<h4 id="Transform-scale-构造方法"><a href="#Transform-scale-构造方法" class="headerlink" title="Transform.scale 构造方法"></a><strong>Transform.scale 构造方法</strong></h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Transform.scale(&#123;</span><br><span class="line">    Key key,</span><br><span class="line">    @required double scale,     <span class="comment">// 缩放比例</span></span><br><span class="line">    <span class="keyword">this</span>.origin,    <span class="comment">// 缩放原点</span></span><br><span class="line">    <span class="keyword">this</span>.alignment = Alignment.center,  <span class="comment">// 对齐方式</span></span><br><span class="line">    <span class="keyword">this</span>.transformHitTests = <span class="literal">true</span>,</span><br><span class="line">    Widget child,</span><br><span class="line">&#125;) : transform = Matrix4.diagonal3Values(scale, scale, <span class="number">1.0</span>),</span><br><span class="line">    <span class="keyword">super</span>(key: key, <span class="attr">child</span>: child);</span><br></pre></td></tr></table></figure>

<p><strong>Tips:</strong></p>
<ol>
<li>设置缩放比例后，水平/竖直方向按同比例缩放，<strong>z</strong> 轴方向不缩放；</li>
<li>对齐方式是与初始位置为准;</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Center(</span><br><span class="line">    child: Transform.scale(</span><br><span class="line">        scale: <span class="number">1.2</span>,</span><br><span class="line"><span class="comment">//      origin: Offset(120.0, 120.0),</span></span><br><span class="line">        alignment: Alignment.bottomRight,</span><br><span class="line">        child: ClipOval(</span><br><span class="line">            child: SizedBox(</span><br><span class="line">                width: <span class="number">120.0</span>,</span><br><span class="line">                height: <span class="number">80.0</span>,</span><br><span class="line">                child: Container(</span><br><span class="line">                    color: Colors.blueAccent))))),</span><br></pre></td></tr></table></figure>

<h4 id="Transform-Matrix4-方式"><a href="#Transform-Matrix4-方式" class="headerlink" title="Transform Matrix4 方式"></a><strong>Transform Matrix4 方式</strong></h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> scale(dynamic x, [double y, double z]) &#123;&#125;</span><br></pre></td></tr></table></figure>

<p> <strong>Matrix4</strong> 为 <strong>4D</strong> 矩阵，使用更灵活，可以分别设置 <strong>x / y / z</strong> 轴方向缩放比例；若只设置一个则水平/垂直方向同比例缩放；</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Center(</span><br><span class="line">    child: Transform(</span><br><span class="line">        transform: Matrix4.identity()</span><br><span class="line">          ..scale(<span class="number">1.2</span>, <span class="number">1.0</span>, <span class="number">0.5</span>),</span><br><span class="line">        alignment: Alignment.bottomRight,</span><br><span class="line">        child: ClipOval(</span><br><span class="line">            child: SizedBox(</span><br><span class="line">                width: <span class="number">120.0</span>,</span><br><span class="line">                height: <span class="number">80.0</span>,</span><br><span class="line">                child: Container(</span><br><span class="line">                    color: Colors.blueAccent)))))</span><br></pre></td></tr></table></figure>

<p><img src="https://upload-images.jianshu.io/upload_images/4118241-6db544c72d1c62df.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<h3 id="二、translate-平移"><a href="#二、translate-平移" class="headerlink" title="二、translate 平移"></a>二、translate 平移</h3><p> <strong>translate 平移</strong> 可通过构造方法或 <strong>Matrix4</strong> 矩阵变化来实现；</p>
<h4 id="Transform-translate-构造方法"><a href="#Transform-translate-构造方法" class="headerlink" title="Transform.translate 构造方法"></a><strong>Transform.translate 构造方法</strong></h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Transform.translate(&#123;</span><br><span class="line">    Key key,</span><br><span class="line">    @required Offset offset,</span><br><span class="line">    <span class="keyword">this</span>.transformHitTests = <span class="literal">true</span>,</span><br><span class="line">    Widget child,</span><br><span class="line">&#125;) : transform = Matrix4.translationValues(offset.dx, offset.dy, <span class="number">0.0</span>),</span><br><span class="line">    origin = <span class="literal">null</span>,</span><br><span class="line">    alignment = <span class="literal">null</span>,</span><br><span class="line">    <span class="keyword">super</span>(key: key, <span class="attr">child</span>: child);</span><br></pre></td></tr></table></figure>

<p> <strong>translate</strong> 按坐标点 <strong>Offset</strong> 平移，水平向右为正向，竖直向下为正向；<strong>z</strong> 轴方向不平移；</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Center(</span><br><span class="line">    child: Transform.translate(</span><br><span class="line">        offset: Offset(<span class="number">60.0</span>, <span class="number">-40.0</span>),</span><br><span class="line">        child: ClipOval(</span><br><span class="line">            child: SizedBox(</span><br><span class="line">                width: <span class="number">120.0</span>,</span><br><span class="line">                height: <span class="number">80.0</span>,</span><br><span class="line">                child: Container(</span><br><span class="line">                    color: Colors.blueAccent))))),</span><br></pre></td></tr></table></figure>

<h4 id="Transform-Matrix4-方式-1"><a href="#Transform-Matrix4-方式-1" class="headerlink" title="Transform Matrix4 方式"></a>Transform Matrix4 方式</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> translate(dynamic x, [double y = <span class="number">0.0</span>, double z = <span class="number">0.0</span>]) &#123;&#125;</span><br></pre></td></tr></table></figure>

<p> <strong>Matrix4</strong> 平移方式可分别设置 <strong>x / y / z</strong> 轴方向平移量，必须设置 <strong>x</strong> 轴方向平移量；</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Center(</span><br><span class="line">    child: Transform(</span><br><span class="line">        transform: Matrix4.identity()</span><br><span class="line">          ..translate(<span class="number">60.0</span>, <span class="number">-40.0</span>, <span class="number">100.0</span>),</span><br><span class="line">        alignment: Alignment.bottomRight,</span><br><span class="line">        child: ClipOval(</span><br><span class="line">            child: SizedBox(</span><br><span class="line">                width: <span class="number">120.0</span>,</span><br><span class="line">                height: <span class="number">80.0</span>,</span><br><span class="line">                child: Container(</span><br><span class="line">                    color: Colors.blueAccent))))),</span><br></pre></td></tr></table></figure>

<p><img src="https://upload-images.jianshu.io/upload_images/4118241-45808af4509c7d2a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<h3 id="三、rotate-旋转"><a href="#三、rotate-旋转" class="headerlink" title="三、rotate 旋转"></a>三、rotate 旋转</h3><p> <strong>rotate 旋转</strong>可通过构造方法或 <strong>Matrix4</strong> 矩阵变化来实现；</p>
<h4 id="Taransform-rotate-构造方法"><a href="#Taransform-rotate-构造方法" class="headerlink" title="Taransform.rotate 构造方法"></a><strong>Taransform.rotate 构造方法</strong></h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Transform.rotate(&#123;</span><br><span class="line">    Key key,</span><br><span class="line">    @required double angle,     <span class="comment">// 旋转角度</span></span><br><span class="line">    <span class="keyword">this</span>.origin,</span><br><span class="line">    <span class="keyword">this</span>.alignment = Alignment.center,</span><br><span class="line">    <span class="keyword">this</span>.transformHitTests = <span class="literal">true</span>,</span><br><span class="line">    Widget child,</span><br><span class="line">&#125;) : transform = Matrix4.rotationZ(angle),</span><br><span class="line">       <span class="keyword">super</span>(key: key, <span class="attr">child</span>: child);</span><br></pre></td></tr></table></figure>

<p>​      由此可看出旋转是沿 <strong>z</strong> 轴旋转，即垂直手机屏幕方向，视觉上的正常旋转；</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Center(</span><br><span class="line">    child: Transform.rotate(</span><br><span class="line">        angle: pi / <span class="number">4</span>,</span><br><span class="line">        child: ClipOval(</span><br><span class="line">            child: SizedBox(</span><br><span class="line">                width: <span class="number">120.0</span>,</span><br><span class="line">                height: <span class="number">80.0</span>,</span><br><span class="line">                child: Container(</span><br><span class="line">                    color: Colors.blueAccent))))),</span><br></pre></td></tr></table></figure>

<h4 id="Transform-Matrix4-方式-2"><a href="#Transform-Matrix4-方式-2" class="headerlink" title="Transform Matrix4 方式"></a><strong>Transform Matrix4 方式</strong></h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> rotate(Vector3 axis, double angle) &#123;&#125;</span><br></pre></td></tr></table></figure>

<p> <strong>Matrix4</strong> 可灵活设置旋转方向，包括沿 <strong>x / y / z</strong> 轴方向立体旋转，且旋转效果可以重叠；而 <strong>Matrix4</strong> 也提供了两种旋转方式；</p>
<ol>
<li><strong>Matrix4.rotationZ</strong></li>
<li><strong>Matrix4.identity()..rotateZ</strong></li>
</ol>
<p>​      对于单轴旋转，两种方式实际是完全相同的，且第一种方式只可进行单轴旋转；第二种方式更灵活，可以多个轴叠加；</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">Center(</span><br><span class="line">    child: Transform(</span><br><span class="line">        transform: Matrix4.rotationZ(pi / <span class="number">4</span>),</span><br><span class="line">        alignment: Alignment.center,</span><br><span class="line">        child: ClipOval(</span><br><span class="line">            child: SizedBox(</span><br><span class="line">                width: <span class="number">120.0</span>,</span><br><span class="line">                height: <span class="number">80.0</span>,</span><br><span class="line">                child: Container(</span><br><span class="line">                    color: Colors.blueAccent))))),</span><br><span class="line">Center(</span><br><span class="line">    child: Transform(</span><br><span class="line">        transform: Matrix4.identity()..rotateX(pi / <span class="number">4</span>),</span><br><span class="line">        alignment: Alignment.center,</span><br><span class="line">        child: ClipOval(</span><br><span class="line">            child: SizedBox(</span><br><span class="line">                width: <span class="number">120.0</span>,</span><br><span class="line">                height: <span class="number">80.0</span>,</span><br><span class="line">                child: Container(</span><br><span class="line">                    color: Colors.greenAccent))))),</span><br><span class="line">Center(</span><br><span class="line">    child: Transform(</span><br><span class="line">        transform: Matrix4.identity()..rotateY(pi / <span class="number">4</span>),</span><br><span class="line">        alignment: Alignment.center,</span><br><span class="line">        child: ClipOval(</span><br><span class="line">            child: SizedBox(</span><br><span class="line">                width: <span class="number">120.0</span>,</span><br><span class="line">                height: <span class="number">80.0</span>,</span><br><span class="line">                child: Container(color: Colors.brown))))),</span><br><span class="line">Center(</span><br><span class="line">    child: ClipOval(</span><br><span class="line">        child: SizedBox(</span><br><span class="line">            width: <span class="number">120.0</span>,</span><br><span class="line">            height: <span class="number">80.0</span>,</span><br><span class="line">            child: Container(color: Colors.black12))))</span><br></pre></td></tr></table></figure>

<p><img src="https://upload-images.jianshu.io/upload_images/4118241-59710ac9b087e311.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png">)<img src="https://upload-images.jianshu.io/upload_images/4118241-d3716bf6327ce8f9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<h3 id="四、skew-斜切"><a href="#四、skew-斜切" class="headerlink" title="四、skew 斜切"></a>四、skew 斜切</h3><p> <strong>Transform</strong> 未提供关于 <strong>skew</strong> 斜切的构造方法，只能用 <strong>Matrix4</strong> 方式构建；</p>
<ol>
<li><strong>skewX</strong> 沿水平方向斜切；</li>
<li><strong>skewY</strong> 沿竖直方向斜切；</li>
<li><strong>skew</strong> 与 <strong>x / y</strong> 轴共同矩阵转换产生斜切；</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">Center(</span><br><span class="line">    child: Transform(</span><br><span class="line">        transform: Matrix4.skewY(pi / <span class="number">4</span>),</span><br><span class="line">        alignment: Alignment.topLeft,</span><br><span class="line">        child: Container(</span><br><span class="line">            width: <span class="number">120.0</span>,</span><br><span class="line">            height: <span class="number">80.0</span>,</span><br><span class="line">            color: Colors.brown))),</span><br><span class="line">Center(</span><br><span class="line">    child: Transform(</span><br><span class="line">        transform: Matrix4.skewX(pi / <span class="number">4</span>),</span><br><span class="line">        alignment: Alignment.topLeft,</span><br><span class="line">        child: Container(</span><br><span class="line">            width: <span class="number">120.0</span>,</span><br><span class="line">            height: <span class="number">80.0</span>,</span><br><span class="line">            color: Colors.redAccent))),</span><br><span class="line">Center(</span><br><span class="line">    child: Transform(</span><br><span class="line">        transform: Matrix4.skew(pi / <span class="number">6</span>, pi / <span class="number">6</span>),</span><br><span class="line">        alignment: Alignment.topLeft,</span><br><span class="line">        child: Container(</span><br><span class="line">            width: <span class="number">120.0</span>,</span><br><span class="line">            height: <span class="number">80.0</span>,</span><br><span class="line">            color: Colors.white70))),</span><br><span class="line">Center(</span><br><span class="line">    child: Transform(</span><br><span class="line">        transform: Matrix4.skew(<span class="number">0.0</span>, <span class="number">0.0</span>),</span><br><span class="line">        alignment: Alignment.topLeft,</span><br><span class="line">        child: Container(</span><br><span class="line">            width: <span class="number">120.0</span>,</span><br><span class="line">            height: <span class="number">80.0</span>,</span><br><span class="line">            color: Colors.black12))),</span><br></pre></td></tr></table></figure>

<p><img src="https://upload-images.jianshu.io/upload_images/4118241-7ae245fad8193302.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png">      所有的矩阵变换均可通过 <strong>Matrix4</strong> 叠加，在实际应用中更加灵活，下节会重点学习 <strong>Matrix4</strong> 矩阵方面的小知识点；</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/07/22/flutter/%E5%AE%9E%E6%88%98%E5%BC%80%E5%8F%91/Flutter%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E5%B8%83%E5%B1%80%E7%BA%A6%E6%9D%9F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="冯星">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="冯星的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/07/22/flutter/%E5%AE%9E%E6%88%98%E5%BC%80%E5%8F%91/Flutter%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E5%B8%83%E5%B1%80%E7%BA%A6%E6%9D%9F/" itemprop="url">Flutter深入理解布局约束</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-07-22T12:24:40+08:00">
                2020-07-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Flutter/" itemprop="url" rel="index">
                    <span itemprop="name">Flutter</span>
                  </a>
                </span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Flutter/Flutter%E5%AE%9E%E6%88%98/" itemprop="url" rel="index">
                    <span itemprop="name">Flutter实战</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2020/07/22/flutter/%E5%AE%9E%E6%88%98%E5%BC%80%E5%8F%91/Flutter%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E5%B8%83%E5%B1%80%E7%BA%A6%E6%9D%9F/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2020/07/22/flutter/%E5%AE%9E%E6%88%98%E5%BC%80%E5%8F%91/Flutter%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E5%B8%83%E5%B1%80%E7%BA%A6%E6%9D%9F/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="一、深入理解布局约束"><a href="#一、深入理解布局约束" class="headerlink" title="一、深入理解布局约束"></a>一、深入理解布局约束</h2><p>我们会经常听到一些开发者在学习 Flutter 时的疑惑：为什么我设置了 <code>width:100</code>， 但是看上去却不是 100 像素宽呢。（注意，本文中的“像素”均指的是逻辑像素） 通常你会回答，将这个 Widget 放进 <code>Center</code> 中，对吧？</p>
<p><strong>别这么干。</strong></p>
<p>如果你这样做了，他们会不断找你询问这样的问题：为什么 <code>FittedBox</code> 又不起作用了？ 为什么 <code>Column</code> 又溢出边界，亦或是 <code>IntrinsicWidth</code> 应该做什么。</p>
<p>其实我们首先应该做的，是告诉他们 Flutter 的布局方式与 HTML 的布局差异相当大 （这些开发者很可能是 Web 开发），然后要让他们熟记这条规则：</p>
<ul>
<li><strong>首先，上层 widget 向下层 widget 传递约束条件。</strong></li>
<li><strong>然后，下层 widget 向上层 widget 传递大小信息。</strong></li>
<li><strong>最后，上层 widget 决定下层 widget 的位置。</strong></li>
</ul>
<p>如果我们在开发时无法熟练运用这条规则，在布局时就不能完全理解其原理，所以越早掌握这条规则越好！</p>
<p><strong>更多细节：</strong></p>
<ul>
<li>Widget 会通过它的 <strong>父级</strong> 获得自身的约束。 约束实际上就是 4 个浮点类型的集合： 最大/最小宽度，以及最大/最小高度。</li>
<li>然后，这个 widget 将会逐个遍历它的 <strong>children</strong> 列表。向子级传递 <strong>约束</strong>（子级之间的约束可能会有所不同），然后询问它的每一个子级需要用于布局的大小。</li>
<li>然后，这个 widget 就会对它子级的 <strong>children</strong> 逐个进行布局。 （水平方向是 <code>x</code> 轴，竖直是 <code>y</code> 轴）</li>
<li>最后，widget 将会把它的大小信息向上传递至父 widget（包括其原始约束条件）。</li>
</ul>
<p>例如，如果一个 widget 中包含了一个具有 padding 的 Column， 并且要对 Column 的子 widget 进行如下的布局：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/4118241-257efca55201e1a3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>那么谈判将会像这样：</p>
<p><strong>Widget</strong>: “嘿！我的父级。我的约束是多少？”</p>
<p><strong>Parent</strong>: “你的宽度必须在 <code>80</code> 到 <code>300</code> 像素之间，高度必须在 <code>30</code> 到 <code>85</code> 之间。”</p>
<p><strong>Widget</strong>: “嗯…我想要 <code>5</code> 个像素的内边距，这样我的子级能最多拥有 <code>290</code> 个像素宽度和 <code>75</code> 个像素高度。”</p>
<p><strong>Widget</strong>: “嘿，我的第一个子级，你的宽度必须要在 <code>0</code> 到 <code>290</code>，高度在 <code>0</code> 到 <code>75</code> 之间。”</p>
<p><strong>First child</strong>: “OK，那我想要 <code>290</code> 像素的宽度，<code>20</code> 个像素的高度。”</p>
<p><strong>Widget</strong>: “嗯…由于我想要将我的第二个子级放在第一个子级下面，所以我们仅剩 <code>55</code> 个像素的高度给第二个子级了。”</p>
<p><strong>Widget</strong>: “嘿，我的第二个子级，你的宽度必须要在 <code>0</code> 到 <code>290</code>，高度在 <code>0</code> 到 <code>55</code> 之间。”</p>
<p><strong>Second child</strong>: “OK，那我想要 <code>140</code> 像素的宽度，<code>30</code> 个像素的高度。”</p>
<p><strong>Widget</strong>: “很好。我的第一个子级将被放在 <code>x: 5</code> &amp; <code>y: 5</code> 的位置， 而我的第二个子级将在 <code>x: 80</code> &amp; <code>y: 25</code> 的位置。”</p>
<p><strong>Widget</strong>: “嘿，我的父级，我决定我的大小为 <code>300</code> 像素宽度，<code>60</code> 像素高度。”</p>
<h2 id="二、限制"><a href="#二、限制" class="headerlink" title="二、限制"></a>二、限制</h2><p>正如上述所介绍的布局规则中所说的那样， Flutter 的布局引擎有一些重要限制：</p>
<ul>
<li>一个 widget 仅在其父级给其约束的情况下才能决定自身的大小。 这意味着 widget 通常情况下 <strong>不能任意获得其想要的大小</strong>。</li>
<li>一个 widget <strong>无法知道，也不需要决定其在屏幕中的位置</strong>。 因为它的位置是由其父级决定的。</li>
<li>当轮到父级决定其大小和位置的时候，同样的也取决于它自身的父级。 所以，在不考虑整棵树的情况下，几乎不可能精确定义任何 widget 的大小和位置。</li>
</ul>
<h2 id="三、案例"><a href="#三、案例" class="headerlink" title="三、案例"></a>三、案例</h2><p>转到<a href="https://juejin.im/post/5f01fe055188252e4a27dfaf#heading-3" target="_blank" rel="noopener">原文地址</a></p>
<h2 id="四、严格约束（Tight）-vs-宽松约束（loose）"><a href="#四、严格约束（Tight）-vs-宽松约束（loose）" class="headerlink" title="四、严格约束（Tight） vs 宽松约束（loose）"></a>四、严格约束（Tight） vs 宽松约束（loose）</h2><p>以后你经常会听到一些约束为严格约束或宽松约束， 你花点时间来弄明白它们是值得的。</p>
<p>严格约束给你了一种获得确切大小的选择。 换句话来说就是，它的最大/最小宽度是一致的，高度也一样。</p>
<p>如果你到 Flutter 的 <code>box.dart</code> 文件中搜索 <code>BoxConstraints</code> 构造器，你会发现以下内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">BoxConstraints.tight(Size size)</span><br><span class="line">   : minWidth &#x3D; size.width,</span><br><span class="line">     maxWidth &#x3D; size.width,</span><br><span class="line">     minHeight &#x3D; size.height,</span><br><span class="line">     maxHeight &#x3D; size.height;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>如果你重新阅读 <a href="#heading-5">样例 2</a>， 它告诉我们屏幕强制 <code>Container</code> 变得和屏幕一样大。 为何屏幕能够做到这一点， 原因就是给 <code>Container</code> 传递了严格约束。</p>
<p>一个宽松约束换句话来说就是设置了最大宽度/高度， 但是让允许其子 widget 获得比它更小的任意大小。 换句话来说，宽松约束的最小宽度/高度为 <strong>0</strong>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">BoxConstraints.loose(Size size)</span><br><span class="line">   : minWidth &#x3D; 0.0,</span><br><span class="line">     maxWidth &#x3D; size.width,</span><br><span class="line">     minHeight &#x3D; 0.0,</span><br><span class="line">     maxHeight &#x3D; size.height;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>如果你访问 <a href="#heading-6">样例 3</a>， 它将会告诉我们 <code>Center</code> 让红色的 <code>Container</code> 变得更小， 但是不能超出屏幕。<code>Center</code> 能够做到这一点的原因就在于 给 <code>Container</code> 的是一个宽松约束。 总的来说，<code>Center</code> 起的作用就是从其父级（屏幕）那里获得的严格约束， 为其子级（<code>Container</code>）转换为宽松约束。</p>
<h2 id="五、了解如何为特定-widget-制定布局规则"><a href="#五、了解如何为特定-widget-制定布局规则" class="headerlink" title="五、了解如何为特定 widget 制定布局规则"></a>五、了解如何为特定 widget 制定布局规则</h2><p>掌握通用布局是非常重要的，但这还不够。</p>
<p>应用一般规则时，每个 widget 都具有很大的自由度， 所以没有办法只看 widget 的名称就知道可能它长什么样。</p>
<p>如果你尝试推测，可能就会猜错。 除非你已阅读 widget 的文档或研究了其源代码， 否则你无法确切知道 widget 的行为。</p>
<p>布局源代码通常很复杂，因此阅读文档是更好的选择。 但是当你在研究布局源代码时，可以使用 IDE 的导航功能轻松找到它。</p>
<p>下面是一个例子：</p>
<ul>
<li>在你的代码中找到一个 <code>Column</code> 并跟进到它的源代码。 为此，请在 (Android Studio/IntelliJ) 中使用 <code>command+B</code>（macOS）或 <code>control+B</code>（Windows/Linux）。 你将跳到 <code>basic.dart</code> 文件中。由于 <code>Column</code> 扩展了 <code>Flex</code>， 请导航至 <code>Flex</code> 源代码（也位于 <code>basic.dart</code> 中）。</li>
<li>向下滚动直到找到一个名为 <code>createRenderObject()</code> 的方法。 如你所见，此方法返回一个 <code>RenderFlex</code>。 它是 <code>Column</code> 的渲染对象， 现在导航到 <code>flex.dart</code> 文件中的 <code>RenderFlex</code> 的源代码。</li>
<li>向下滚动，直到找到 <code>performLayout()</code> 方法， 由该方法执行列布局。</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/4118241-88c13ddfb4b558dc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/07/21/flutter/%E5%AE%9E%E6%88%98%E5%BC%80%E5%8F%91/Flutter%E5%BF%AB%E6%8D%B7%E5%BC%80%E5%8F%91MacAndroidStudio%E7%AF%87/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="冯星">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="冯星的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/07/21/flutter/%E5%AE%9E%E6%88%98%E5%BC%80%E5%8F%91/Flutter%E5%BF%AB%E6%8D%B7%E5%BC%80%E5%8F%91MacAndroidStudio%E7%AF%87/" itemprop="url">Flutter快捷开发MacAndroidStudio篇</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-07-21T23:32:58+08:00">
                2020-07-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Flutter/" itemprop="url" rel="index">
                    <span itemprop="name">Flutter</span>
                  </a>
                </span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Flutter/Flutter%E5%AE%9E%E6%88%98/" itemprop="url" rel="index">
                    <span itemprop="name">Flutter实战</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2020/07/21/flutter/%E5%AE%9E%E6%88%98%E5%BC%80%E5%8F%91/Flutter%E5%BF%AB%E6%8D%B7%E5%BC%80%E5%8F%91MacAndroidStudio%E7%AF%87/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2020/07/21/flutter/%E5%AE%9E%E6%88%98%E5%BC%80%E5%8F%91/Flutter%E5%BF%AB%E6%8D%B7%E5%BC%80%E5%8F%91MacAndroidStudio%E7%AF%87/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="一、快捷命令"><a href="#一、快捷命令" class="headerlink" title="一、快捷命令"></a>一、快捷命令</h2><h3 id="1-1-快速创建一个新的Stateless-or-Stateful组件"><a href="#1-1-快速创建一个新的Stateless-or-Stateful组件" class="headerlink" title="1.1 快速创建一个新的Stateless or Stateful组件"></a>1.1 快速创建一个新的Stateless or Stateful组件</h3><h4 id="创建新的-Stateless-组件，输入stless，回车："><a href="#创建新的-Stateless-组件，输入stless，回车：" class="headerlink" title="创建新的 Stateless 组件，输入stless，回车："></a>创建新的 Stateless 组件，输入stless，回车：</h4><p><img src="https://user-gold-cdn.xitu.io/2020/7/16/17354caffe6cf9ab?imageslim" alt="img"></p>
<h4 id="创建新的-Stateful-组件，输入-stful，回车："><a href="#创建新的-Stateful-组件，输入-stful，回车：" class="headerlink" title="创建新的 Stateful 组件，输入 stful，回车："></a>创建新的 Stateful 组件，输入 stful，回车：</h4><p><img src="https://user-gold-cdn.xitu.io/2020/7/16/17354cb01fa2b87b?imageslim" alt="img"></p>
<h3 id="1-2-创建新的-动画组件，输入-stanim，回车："><a href="#1-2-创建新的-动画组件，输入-stanim，回车：" class="headerlink" title="1.2 创建新的 动画组件，输入 stanim，回车："></a>1.2 创建新的 动画组件，输入 stanim，回车：</h3><p><img src="https://user-gold-cdn.xitu.io/2020/7/16/17354cb08e651fd9?imageslim" alt="img"></p>
<h3 id="1-3其它"><a href="#1-3其它" class="headerlink" title="1.3其它"></a>1.3其它</h3><p>还有其他的一些快捷方式，这里不一一介绍，这些快捷方式在 <strong>Preferences</strong> 中可以找到，路径：Preferences -&gt; Editor -&gt; Live Templates:</p>
<p><img src="https://upload-images.jianshu.io/upload_images/4118241-e268441840514553.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<h2 id="二、File-And-Code-Templates"><a href="#二、File-And-Code-Templates" class="headerlink" title="二、File And Code Templates"></a>二、File And Code Templates</h2><p>创建 Dart 文件时，生成默认代码，打开 Preferences -&gt; Editor -&gt; File And Code Templates，选中右侧的 Files 标签，默认里面是空的</p>
<p>加入自动生成代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">import &#39;package:flutter&#x2F;material.dart&#39;;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;&#x2F; 项目：$&#123;PROJECT_NAME&#125;</span><br><span class="line">&#x2F;&#x2F;&#x2F; 包层次结构：$&#123;PACKAGE_NAME&#125;</span><br><span class="line">&#x2F;&#x2F;&#x2F; 文件： $&#123;NAME&#125;</span><br><span class="line">&#x2F;&#x2F;&#x2F; 创建者：$&#123;USER&#125;</span><br><span class="line">&#x2F;&#x2F;&#x2F; 创建时间：$&#123;DATE&#125; $&#123;TIME&#125;</span><br><span class="line">&#x2F;&#x2F;&#x2F; 文件描述:</span><br><span class="line">class $&#123;NAME&#125; extends StatelessWidget &#123;</span><br><span class="line">  @override</span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    return Container();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://upload-images.jianshu.io/upload_images/4118241-efcaba5ef79a90a7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>新创建的 dart 文件自动生成了预置的代码。</p>
<p><img src="https://upload-images.jianshu.io/upload_images/4118241-73c8f0bbd40f16ae.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<h2 id="三、格式化代码"><a href="#三、格式化代码" class="headerlink" title="三、格式化代码"></a>三、格式化代码</h2><p>快捷键：option + command + L（字母 L 键）</p>
<p><img src="https://user-gold-cdn.xitu.io/2020/7/16/17354cb199a0b208?imageslim" alt="img"></p>
<h2 id="四、清除无用引用"><a href="#四、清除无用引用" class="headerlink" title="四、清除无用引用"></a>四、清除无用引用</h2><p>快捷键：control + option + O（字母 O 键）</p>
<p><img src="https://user-gold-cdn.xitu.io/2020/7/16/17354cb1b4728b5e?imageslim" alt="img"></p>
<h2 id="五、前进-后退光标的位置"><a href="#五、前进-后退光标的位置" class="headerlink" title="五、前进/后退光标的位置"></a>五、前进/后退光标的位置</h2><p>当跟踪代码的时候，经常跳转到其他类，后退快捷键：option+command+方向左键，前进快捷键：option+command+方向右键，</p>
<p><img src="https://user-gold-cdn.xitu.io/2020/7/16/17354cb1e7c47387?imageslim" alt="img"></p>
<h2 id="六、查看当前类的继承关系"><a href="#六、查看当前类的继承关系" class="headerlink" title="六、查看当前类的继承关系"></a>六、查看当前类的继承关系</h2><p>快捷键： control + H</p>
<p><img src="https://user-gold-cdn.xitu.io/2020/7/16/17354cb28acd7668?imageslim" alt="img"></p>
<h2 id="七、自动定位"><a href="#七、自动定位" class="headerlink" title="七、自动定位"></a>七、自动定位</h2><p>右侧进入一个代码文件时，左侧自定定位到此文件，在 project 标签 设置中勾选 Autoscroll to source 和 Autoscroll from source。</p>
<p><img src="https://upload-images.jianshu.io/upload_images/4118241-267dee58ec7a2320.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<h2 id="Flutter-资源网站"><a href="#Flutter-资源网站" class="headerlink" title="Flutter 资源网站"></a>Flutter 资源网站</h2><ol>
<li>官网：<a href="https://flutter.dev/" target="_blank" rel="noopener">flutter.dev/</a></li>
<li>中文网：<a href="https://flutterchina.club/" target="_blank" rel="noopener">flutterchina.club/</a></li>
<li>Flutter 中文社区资源：<a href="https://flutter-io.cn/" target="_blank" rel="noopener">flutter-io.cn/</a></li>
<li>pub(国内)：<a href="https://pub.flutter-io.cn/" target="_blank" rel="noopener">pub.flutter-io.cn/</a></li>
<li>pub：<a href="https://pub.dev/" target="_blank" rel="noopener">pub.dev/</a></li>
<li>DartPad：<a href="https://dartpad.dartlang.org/" target="_blank" rel="noopener">dartpad.dartlang.org/</a></li>
<li>Dart 官网：<a href="https://dart.dev/" target="_blank" rel="noopener">dart.dev/</a></li>
<li>CodePen：<a href="https://codepen.io/" target="_blank" rel="noopener">codepen.io/</a></li>
<li>Json 转实体类：<a href="https://javiercbk.github.io/json_to_dart/" target="_blank" rel="noopener">javiercbk.github.io/json_to_dar…</a></li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/07/20/flutter/%E6%9C%AA%E6%9B%BE%E7%90%86%E8%A7%A3/%E5%A4%8D%E6%9D%82%E4%B8%9A%E5%8A%A1%E5%A6%82%E4%BD%95%E4%BF%9D%E8%AF%81Flutter%E7%9A%84%E9%AB%98%E6%80%A7%E8%83%BD%E9%AB%98%E6%B5%81%E7%95%85%E5%BA%A6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="冯星">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="冯星的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/07/20/flutter/%E6%9C%AA%E6%9B%BE%E7%90%86%E8%A7%A3/%E5%A4%8D%E6%9D%82%E4%B8%9A%E5%8A%A1%E5%A6%82%E4%BD%95%E4%BF%9D%E8%AF%81Flutter%E7%9A%84%E9%AB%98%E6%80%A7%E8%83%BD%E9%AB%98%E6%B5%81%E7%95%85%E5%BA%A6/" itemprop="url">复杂业务如何保证Flutter的高性能高流畅度</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-07-20T22:06:36+08:00">
                2020-07-20
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2020/07/20/flutter/%E6%9C%AA%E6%9B%BE%E7%90%86%E8%A7%A3/%E5%A4%8D%E6%9D%82%E4%B8%9A%E5%8A%A1%E5%A6%82%E4%BD%95%E4%BF%9D%E8%AF%81Flutter%E7%9A%84%E9%AB%98%E6%80%A7%E8%83%BD%E9%AB%98%E6%B5%81%E7%95%85%E5%BA%A6/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2020/07/20/flutter/%E6%9C%AA%E6%9B%BE%E7%90%86%E8%A7%A3/%E5%A4%8D%E6%9D%82%E4%B8%9A%E5%8A%A1%E5%A6%82%E4%BD%95%E4%BF%9D%E8%AF%81Flutter%E7%9A%84%E9%AB%98%E6%80%A7%E8%83%BD%E9%AB%98%E6%B5%81%E7%95%85%E5%BA%A6/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>高性能高流畅度一直是Flutter团队宣传的一大亮点，也是当初闲鱼选择Flutter的重要因素之一，但是随着复杂业务的应用落地，通过Flutter页面和原生页面滑动流畅度对比，我们开始产生怀疑，因为部分Flutter页面流畅度明显低于Native，是Flutter的宣传言过其实还是我们开发人员使用姿势有问题，今天我们就来具体分析下。</p>
<h3 id="Flutter渲染原理简介"><a href="#Flutter渲染原理简介" class="headerlink" title="Flutter渲染原理简介"></a>Flutter渲染原理简介</h3><p>优化之前我们先来介绍下Flutter的渲染原理，通过这部分基础了解渲染流程以及主要耗时花费</p>
<p>flutter视图树包含了三颗树：Widget、Element、RenderObject</p>
<ul>
<li>Widget: 存放渲染内容、它只是一个配置数据结构，创建是非常轻量的，在页面刷新的过程中随时会重建</li>
<li>Element: 同时持有Widget和RenderObject，存放上下文信息，通过它来遍历视图树，支撑UI结构</li>
<li>RenderObject: 根据Widget的布局属性进行layout，paint ，负责真正的渲染</li>
</ul>
<p>从创建到渲染的大体流程是：根据Widget生成Element，然后创建相应的RenderObject并关联到Element.renderObject属性上，最后再通过RenderObject来完成布局排列和绘制。</p>
<p>例如下面这段布局代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Container(</span><br><span class="line">      color: Colors.blue,</span><br><span class="line">      child: Row(</span><br><span class="line">        children: &lt;Widget&gt;[</span><br><span class="line">          Image.asset(&#39;image&#39;),</span><br><span class="line">          Text(&#39;text&#39;),</span><br><span class="line">        ],</span><br><span class="line">      ),</span><br><span class="line">    );</span><br></pre></td></tr></table></figure>

<p>对应三棵树的结构如下图</p>
<p><img src="https://pic1.zhimg.com/80/v2-871d65414702552fd3daf3e9ed468632_1440w.jpg" alt="img"></p>
<p>了解了这三棵树，我们再来看下页面刷新的时候具体做了哪些操作</p>
<p>当需要更新UI的时候，Framework通知Engine，Engine会等到下个Vsync信号到达的时候，会通知Framework进行animate, build，layout，paint，最后生成layer提交给Engine。Engine会把layer进行组合，生成纹理，最后通过Open Gl接口提交数据给GPU， GPU经过处理后在显示器上面显示，如下图：</p>
<p><img src="https://picb.zhimg.com/80/v2-1e5b51ac70061f9c36c5be080968e881_1440w.jpg" alt="img"></p>
<p>结合前面的例子，如果text文本或者image内容发生变化会触发哪些操作呢？</p>
<p>Widget是不可改变，需要重新创建一颗新树，build开始，然后对上一帧的element树做遍历，调用他的updateChild，看子节点类型跟之前是不是一样，不一样的话就把子节点扔掉，创造一个新的，一样的话就做内容更新，对renderObject做updateRenderObject操作，updateRenderObject内部实现会判断现在的节点跟上一帧是不是有改动，有改动才会别标记dirty，重新layout、paint，再生成新的layer交给GPU，流程如下图：</p>
<p><img src="https://pic2.zhimg.com/80/v2-f76f7b02b7e2818a6ec32f1399f8dde3_1440w.jpg" alt="img"></p>
<p>到这里大家对Flutter在渲染方面有基本的理解，作为后面优化部分内容理解的基础</p>
<h3 id="性能分析工具及方法"><a href="#性能分析工具及方法" class="headerlink" title="性能分析工具及方法"></a>性能分析工具及方法</h3><p>下面来看下性能分析工具，注意，统计性能数据一定要在真机+profile模式下运行，拿到最接近真实的体验数据。</p>
<h3 id="performance-overlay"><a href="#performance-overlay" class="headerlink" title="performance overlay"></a>performance overlay</h3><p>平时常用的性能分析工具有performance overlay，通过他可以直观看到当前帧的耗时，但是他是UI线程和GPU线程分开展示的，UI Task Runner是Flutter Engine用于执行Dart root isolate代码，GPU Task Runner被用于执行设备GPU的相关调用。绿色的线表示当前帧，出现红色则表示耗时超过16.6ms，也就是发生丢帧现象</p>
<p><img src="https://picb.zhimg.com/80/v2-c7f72ec1facf96a953f447ea414f8be1_1440w.jpg" alt="img"></p>
<h3 id="Dart-DevTool"><a href="#Dart-DevTool" class="headerlink" title="Dart DevTool"></a>Dart DevTool</h3><p>另一个工具是Dart DevTool ，就是早期的Observatory，官方提供的性能检测工具。它的 timeline 界面可以让逐帧分析应用的 UI 性能。但是目前还是预览版，存在一些问题。</p>
<p>profile模式下运行起来，点击android studio底部的菜单按钮，会弹出一个网页</p>
<p><img src="https://pic4.zhimg.com/80/v2-e13af00a4fdb29dc51fed89c4f629642_1440w.jpg" alt="img"></p>
<p>点击顶部的Timeline菜单</p>
<p><img src="https://pic4.zhimg.com/80/v2-3c9361ddec4bc12116ac2b55eb123d5a_1440w.jpg" alt="img"></p>
<p>这个时候滑动页面，每一帧的耗时会以柱形bar的形式显示在页面上，每条bar代表一个frame，同时用不同颜色区分UI/GPU线程耗时，这个时候我们要分析卡顿的场景就需要选中一条红色的bar（总耗时超过16.6ms），中间区域的Frame events chart显示了当前选中的frame的事件跟踪，UI和GPU事件是独立的事件流，但它们共享一个公共的时间轴。</p>
<p>选中Frame events chart中的某个事件，以上图为例Layout耗时最长，我们选中它，会在底部Flame chart区域显示一个自顶向下的堆栈跟踪，每个堆栈帧的宽度表示它消耗CPU的时长，消耗大量CPU时长的堆栈是我们首要分析的重点，后面就是具体分析堆栈，定位卡顿问题。</p>
<h3 id="debug调试工具"><a href="#debug调试工具" class="headerlink" title="debug调试工具"></a>debug调试工具</h3><p>另外还有一些debug调试工具可以辅助查看更多信息，注意，只能在debug模式下使用分析，拿到的数据不能作为性能标准</p>
<p>debugProfileBuildsEnabled：向 Timeline 事件中添加每个widget的build 信息</p>
<p>debugProfilePaintsEnabled： 向 timeline 事件中添加每个renderObject的paint 信息</p>
<p>debugPaintLayerBordersEnabled：每个layer会出现一个边框，帮助区分layer层级</p>
<p>debugPrintRebuildDirtyWidgets：打印标记为dirty的widgets</p>
<p>debugPrintLayouts：打印标记为dirty的renderObjects</p>
<p>debugPrintBeginFrameBanner/debugPrintEndFrameBanner：打印每帧开始和结束</p>
<h3 id="实例分析"><a href="#实例分析" class="headerlink" title="实例分析"></a>实例分析</h3><p>了解这些工具下面我们来看个简单的demo具体分析下，一个由Column、Container、ListView嵌套的布局，其中有个定时器控制Text中显示的文本实时更新</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line">import &#39;dart:async&#39;;</span><br><span class="line">import &#39;package:flutter&#x2F;material.dart&#39;;</span><br><span class="line">import &#39;package:flutter&#x2F;widgets.dart&#39;;</span><br><span class="line"></span><br><span class="line">class TestDemo extends StatefulWidget &#123;</span><br><span class="line">  @override</span><br><span class="line">  State&lt;StatefulWidget&gt; createState() &#123;</span><br><span class="line">    return _TestDemoState();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class _TestDemoState extends State&lt;TestDemo&gt; &#123;</span><br><span class="line">  int _count &#x3D; 0;</span><br><span class="line">  Timer _timer;</span><br><span class="line">  @override</span><br><span class="line">  void initState() &#123;</span><br><span class="line">    super.initState();</span><br><span class="line">    _timer &#x3D; Timer.periodic(Duration(milliseconds: 1000), (t) &#123;</span><br><span class="line">      setState(() &#123;</span><br><span class="line">        _count++;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  @override</span><br><span class="line">  void dispose() &#123;</span><br><span class="line">    if (_timer !&#x3D; null) &#123;</span><br><span class="line">      if (_timer.isActive) &#123;</span><br><span class="line">        _timer.cancel();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    super.dispose();</span><br><span class="line">  &#125;</span><br><span class="line">  @override</span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    return new Scaffold(</span><br><span class="line">        appBar: new AppBar(</span><br><span class="line">          title: new Text(&quot;Test Demo&quot;),</span><br><span class="line">        ),</span><br><span class="line">        body: content()</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">  Widget content()&#123;</span><br><span class="line">    Widget result &#x3D; Column(</span><br><span class="line">      children: &lt;Widget&gt;[</span><br><span class="line">        Container(</span><br><span class="line">          margin: EdgeInsets.fromLTRB(10,10,10,5),</span><br><span class="line">          height: 100,</span><br><span class="line">          color: Color(0xff1fbfbf),</span><br><span class="line">        ),</span><br><span class="line">        Container(</span><br><span class="line">          margin: EdgeInsets.fromLTRB(10,5,10,10),</span><br><span class="line">          height: 100,</span><br><span class="line">          color: Color(0xff1b8bdf),</span><br><span class="line">        ),</span><br><span class="line">        Container(</span><br><span class="line">          height: 100,</span><br><span class="line">          child: ListView.builder(</span><br><span class="line">              scrollDirection: Axis.horizontal,</span><br><span class="line">              itemCount: 5,</span><br><span class="line">              itemBuilder: (context, index) &#123;</span><br><span class="line">                return Container(</span><br><span class="line">                  width: 70,</span><br><span class="line">                  height: 70,</span><br><span class="line">                  child: Image.asset(</span><br><span class="line">                    &#39;assets&#x2F;images&#x2F;common_empty.png&#39;,</span><br><span class="line">                    width: 50,</span><br><span class="line">                    height: 50,</span><br><span class="line">                  ),</span><br><span class="line">                );</span><br><span class="line">              &#125;),</span><br><span class="line">        ),</span><br><span class="line"></span><br><span class="line">        Container(</span><br><span class="line">            margin: EdgeInsets.fromLTRB(10,20,10,10),</span><br><span class="line">            height: 100,</span><br><span class="line">            width: 350,</span><br><span class="line">            color: Colors.yellow,</span><br><span class="line">            child: Center(</span><br><span class="line">              child:</span><br><span class="line">              Text(</span><br><span class="line">                _count.toString(),</span><br><span class="line">                style: TextStyle(fontSize: 18, fontWeight:FontWeight.bold),</span><br><span class="line">              ),</span><br><span class="line">            )</span><br><span class="line">        ),</span><br><span class="line">      ],</span><br><span class="line">    );</span><br><span class="line">    return result;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><img src="https://picb.zhimg.com/80/v2-60a9b01b819348ae851d13ad8675b8a5_1440w.jpg" alt="img"></p>
<p>大部分widget都是静态的，只有黄色Container中包含一个内容一直刷新的Text，这个时候我们打开debugProfileBuildsEnabled，用Timeline分析下它的渲染耗时，可以通过Frame events chart中显示的build层级非常深</p>
<p><img src="https://pic2.zhimg.com/80/v2-f916161cd181b310e4372f66002c71d3_1440w.jpg" alt="img"></p>
<p>结合第一部分渲染原理我们了解到，每次定时器刷新text数字的时候，整个页面widget树都会重新build，但其实只有最底层Container中的Text内容在改变，没有必要刷新整颗树，所以这里我们的优化方案是<strong>提高build效率，降低Widget tree遍历的出发点，将setState刷新数据尽量下发到底层节点</strong>，所以将Text单独抽取成独立的Widget，setState下发到抽取出的Widget内部</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">class _TestDemoState extends State&lt;TestDemo&gt; &#123;</span><br><span class="line"></span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">  Widget content()&#123;</span><br><span class="line">    Widget result &#x3D; Column(</span><br><span class="line">      children: &lt;Widget&gt;[</span><br><span class="line">        ...</span><br><span class="line">        Container(</span><br><span class="line">            margin: EdgeInsets.fromLTRB(10,20,10,10),</span><br><span class="line">            height: 100,</span><br><span class="line">            width: 350,</span><br><span class="line">            color: Colors.yellow,</span><br><span class="line">            child: Center(</span><br><span class="line">              child:</span><br><span class="line">                  CountText()</span><br><span class="line">            )</span><br><span class="line">        ),</span><br><span class="line">      ],</span><br><span class="line">    );</span><br><span class="line">    return result;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class CountText extends StatefulWidget &#123;</span><br><span class="line">  @override</span><br><span class="line">  State&lt;StatefulWidget&gt; createState() &#123;</span><br><span class="line">    return _CountTextState();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class _CountTextState extends State&lt;CountText&gt; &#123;</span><br><span class="line">  int _count &#x3D; 0;</span><br><span class="line">  Timer _timer;</span><br><span class="line">  @override</span><br><span class="line">  void initState() &#123;</span><br><span class="line">    super.initState();</span><br><span class="line">    _timer &#x3D; Timer.periodic(Duration(milliseconds: 1000), (t) &#123;</span><br><span class="line">      setState(() &#123;</span><br><span class="line">        _count++;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  @override</span><br><span class="line">  void dispose() &#123;</span><br><span class="line">    if (_timer !&#x3D; null) &#123;</span><br><span class="line">      if (_timer.isActive) &#123;</span><br><span class="line">        _timer.cancel();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    super.dispose();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  @override</span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    return Text(</span><br><span class="line">      _count.toString(),</span><br><span class="line">      style: TextStyle(fontSize: 18, fontWeight:FontWeight.bold),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改后的Timeline显示如下图：</p>
<p><img src="https://pic3.zhimg.com/80/v2-41d1e54a7d152cfc1f63a7641c9dcdd6_1440w.jpg" alt="img"></p>
<p>build层级明显减少，总耗时也明显降低</p>
<p>接下来分析下Paint过程有没有可以优化的部分，我们打开debugProfilePaintsEnabled变量分析可以看到Timeline显示的paint层级</p>
<p><img src="https://pic3.zhimg.com/80/v2-2f7d9472d96992170659e325b8a373e0_1440w.jpg" alt="img"></p>
<p><img src="https://pic1.zhimg.com/80/v2-76c046b5f8fa38ca918bc8c92e9ed283_1440w.jpg" alt="img"></p>
<p>通过<code>debugPaintLayerBordersEnabled = true;</code>显示layer边框可以看到不断变化的Text和其他Widget都是在同一个layer中的，这里我们想到的优化点是<strong>利用RepaintBoundary提高paint效率，它为经常发生显示变化的内容提供一个新的隔离layer，新的layer paint不会影响到其他layer</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">RepaintBoundary(</span><br><span class="line">          child: Container(</span><br><span class="line">              margin: EdgeInsets.fromLTRB(10,20,10,10),</span><br><span class="line">              height: 100,</span><br><span class="line">              width: 350,</span><br><span class="line">              color: Colors.yellow,</span><br><span class="line">              child: Center(</span><br><span class="line">                  child: CountText()</span><br><span class="line">              )</span><br><span class="line">          ),</span><br><span class="line">        ),</span><br></pre></td></tr></table></figure>

<p>看下优化后的效果</p>
<p><img src="https://picb.zhimg.com/80/v2-a0bec82598163aa8f9590f3a5ed275a0_1440w.jpg" alt="img"></p>
<p><img src="https://pic2.zhimg.com/80/v2-92abea1bc18cbe7595134361d7a4b87b_1440w.jpg" alt="img"></p>
<p>可以看到我们为黄色的Container建立了单独的layer，并且paint的层级减少很多</p>
<h3 id="总结常见问题"><a href="#总结常见问题" class="headerlink" title="总结常见问题"></a>总结常见问题</h3><ol>
<li>提高build效率，setState刷新数据尽量下发到底层节点</li>
<li>提高paint效率，RepaintBoundry创建单独layer减少重绘区域</li>
</ol>
<p>这两个我们之前的例子已经具体分析过</p>
<ol>
<li>减少build中逻辑处理，因为widget在页面刷新的过程中随时会通过build重建，build调用频繁，我们应该只处理跟UI相关的逻辑</li>
<li>减少saveLayer（ShaderMask、ColorFilter、Text Overflow）、clipPath的使用，saveLayer会在GPU中分配一块新的绘图缓冲区，切换绘图目标，这个操作是在GPU中非常耗时的，clipPath会影响每个绘图指令,做相交操作，之外的部分剔除掉，所以这也是个耗时操作</li>
<li>减少Opacity Widget 使用，尤其是在动画中，因为他会导致widget每一帧都会被重建，可以用 AnimatedOpacity 或 FadeInImage 进行代替</li>
</ol>
<p>以上内容介绍了些Flutter常见的性能问题以及我们怎么用工具检测这个问题，在平时开发过程中要留意规避这类问题</p>
<h3 id="Flutter-DX案例分析"><a href="#Flutter-DX案例分析" class="headerlink" title="Flutter-DX案例分析"></a>Flutter-DX案例分析</h3><p>近期我们做了个Flutter端的动态化模板渲染方案Flutter-DX，它使用集团DinamicX的DSL，通过下发DSL模板，在Flutter侧实现动态解析渲染。具体介绍可以参考之前的文章：</p>
<p><a href="https://zhuanlan.zhihu.com/p/83331937" target="_blank" rel="noopener">如何在Flutter上实现高性能的动态模板渲染</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/90195812" target="_blank" rel="noopener">做一个高一致性、高性能的Flutter动态渲染，真的很难么？</a></p>
<p>这里不再详细介绍。</p>
<p>尽管进行了一次渲染架构升级，很大程度上提升性能表现，但是通过高可用线上统计，发现在长列表场景下fps值没有达到预期值，所以需要进一步分析哪些操作导致的耗时问题。</p>
<p>以搜索页页面结构为例，外部是GridView的容器，里面都是一个个DX模板组成的宝贝card，滑动过程中发现流畅度要明显偏低</p>
<p>所以我们做了以下的优化措施</p>
<p>1.针对Sliver滑动的优化，sliver在滑动过程中，有一个超出屏幕上下250像素的一个缓存区</p>
<p><img src="https://picb.zhimg.com/80/v2-a7d4c4ef26c1474f9c201a9c865c2dac_1440w.jpg" alt="img"></p>
<p>在列表滚动过程中，DX card不断的被重建和销毁，没有任何缓存机制，我们在其中加了个缓存池，流程如下，避免element不断的被销毁和创建，一定程度提高流畅度</p>
<p><img src="https://pic3.zhimg.com/80/v2-68962dcc3faf1d4d48fa47ad87279fe2_1440w.jpg" alt="img"></p>
<p>\2. 通过Timeline分析发现TextPaint的layout耗时显著，进一步对比分析发现，同样的UI显示，带换行符的长文本长度layout耗时明显偏高，</p>
<p>后来确认带换行符的文本会影响布局效率，具体分析可以查看 <a href="https://link.zhihu.com/?target=https%3A//github.com/flutter/flutter/issues/52651">issue</a></p>
<p><img src="https://pic3.zhimg.com/80/v2-2f7104a6c8c7e4aefdd512b9e3f29d5d_1440w.jpg" alt="img"></p>
<p>这里我们做的优化措施是在判断只有一行文本显示的情况下，截取换行符前的内容作为text文本，从而提升TextPaint layout效率。</p>
<p>除此之外，还有一些减少布局层级和简化build流程，预加载缓存等措施，实现将FPS提升3个点，达到一定程度的优化效果。</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>以上内容分析了flutter的渲染原理以及遇到卡顿问题可以用哪些工具从哪些方向入手分析，Flutter虽然一直宣称流畅度是一大亮点，但也存在一定的优化空间，以及需要开发者掌握一定的开发技巧才能达到更丝滑的体验。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/07/20/flutter/%E5%AE%9E%E6%88%98%E5%BC%80%E5%8F%91/Flutter%E8%A7%A3%E6%9E%90JSON/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="冯星">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="冯星的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/07/20/flutter/%E5%AE%9E%E6%88%98%E5%BC%80%E5%8F%91/Flutter%E8%A7%A3%E6%9E%90JSON/" itemprop="url">Flutter解析JSON</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-07-20T16:30:03+08:00">
                2020-07-20
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Flutter/" itemprop="url" rel="index">
                    <span itemprop="name">Flutter</span>
                  </a>
                </span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Flutter/Flutter%E5%AE%9E%E6%88%98/" itemprop="url" rel="index">
                    <span itemprop="name">Flutter实战</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2020/07/20/flutter/%E5%AE%9E%E6%88%98%E5%BC%80%E5%8F%91/Flutter%E8%A7%A3%E6%9E%90JSON/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2020/07/20/flutter/%E5%AE%9E%E6%88%98%E5%BC%80%E5%8F%91/Flutter%E8%A7%A3%E6%9E%90JSON/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="译-在-Flutter-中解析复杂的-JSON"><a href="#译-在-Flutter-中解析复杂的-JSON" class="headerlink" title="[译]在 Flutter 中解析复杂的 JSON"></a>[译]在 Flutter 中解析复杂的 JSON</h1><blockquote>
<ul>
<li>原文地址：<a href="https://medium.com/flutter-community/parsing-complex-json-in-flutter-747c46655f51" target="_blank" rel="noopener">Parsing complex JSON in Flutter</a></li>
<li>原文作者：<a href="https://medium.com/@poojabhaumik?source=post_header_lockup" target="_blank" rel="noopener">Poojã Bhaumik</a></li>
<li>译文出自：<a href="https://github.com/xitu/gold-miner" target="_blank" rel="noopener">掘金翻译计划</a></li>
<li>本文永久链接：<a href="https://github.com/xitu/gold-miner/blob/master/TODO1/parsing-complex-json-in-flutter.md" target="_blank" rel="noopener">github.com/xitu/gold-m…</a></li>
<li>译者：<a href="https://github.com/DateBro" target="_blank" rel="noopener">DateBro</a></li>
<li>校对者：<a href="https://github.com/leviding" target="_blank" rel="noopener">LeviDing</a></li>
</ul>
</blockquote>
<p>我必须承认，在 Flutter/Dart 中使用 JSON 后，我一直想念 <strong>gson</strong> 的 Android 世界。当我开始使用 Flutter 中的 API 时，JSON 解析真的让我很困扰。而且我敢确定，它也让很多初学者感到困惑。</p>
<p>我们将在这篇博客中使用内置的 <code>dart:convert</code> 库。这是最基本的解析方法，只有在你刚开始使用 Flutter 或者你正在写一个小项目时才建议使用它。不过，了解一些 Flutter 中 JSON 解析的基础知识非常重要。如果你精通这个，或者你需要写更大的项目时，可以考虑像 <a href="https://pub.dartlang.org/packages/json_serializable" target="_blank" rel="noopener">json_serializable</a> 等代码生成器库。如果可能的话，我会在以后的文章中介绍它们。</p>
<p>Fork 这个<a href="https://github.com/PoojaB26/ParsingJSON-Flutter" target="_blank" rel="noopener">示例项目</a>。它包含这篇博客中的所有代码，你可以对照着实践一下。</p>
<h3 id="JSON-结构-1：简单的-map"><a href="#JSON-结构-1：简单的-map" class="headerlink" title="JSON 结构 #1：简单的 map"></a>JSON 结构 #1：简单的 map</h3><p>让我们从一个简单的 JSON 结构开始 —— <a href="https://github.com/PoojaB26/ParsingJSON-Flutter/blob/master/assets/student.json" target="_blank" rel="noopener">student.json</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;id&quot;:&quot;487349&quot;,</span><br><span class="line">  &quot;name&quot;:&quot;Pooja Bhaumik&quot;,</span><br><span class="line">  &quot;score&quot; : 1000</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p><strong>规则 #1：</strong> <strong>确定结构。Json 字符串将具有 Map（键值对）或 List of Maps。</strong></p>
<p><strong>规则 #2：用花括号开始？这是 map。用方括号开始？那是 List of maps。</strong></p>
<p><code>student.json</code> 明显是 map（比如，<code>id</code> 是键，<code>487349</code> 是 <code>id</code> 的值）。</p>
<p>让我们为这个 json 结构做一个 PODO（Plain Old Dart Object？）文件。你可以在示例项目的 <a href="https://github.com/PoojaB26/ParsingJSON-Flutter/blob/master/lib/model/student_model.dart" target="_blank" rel="noopener">student_model.dart</a> 文件中找到这段代码。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">class Student&#123;</span><br><span class="line">  String studentId;</span><br><span class="line">  String studentName;</span><br><span class="line">  int studentScores;</span><br><span class="line"></span><br><span class="line">  Student(&#123;</span><br><span class="line">    this.studentId,</span><br><span class="line">    this.studentName,</span><br><span class="line">    this.studentScores</span><br><span class="line"> &#125;);</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>Perfect！ <strong>是这样吗？</strong> 因为 json 映射和这个 PODO 文件之间没有映射。甚至实体名称也不匹配。 <strong>我知道我知道。</strong> 我们还没有完成。我们必须将这些类成员映射到 json 对象。为此，我们需要创建一个 <code>factory</code> 方法。根据 Dart 文档，我们在实现一个构造函数时使用 <code>factory</code> 关键字时，这个构造函数不会总是创建其类的新实例，而这正是我们现在所需要的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">factory Student.fromJson(Map&lt;String, dynamic&gt; parsedJson)&#123;</span><br><span class="line">    return Student(</span><br><span class="line">      studentId: parsedJson[&#39;id&#39;],</span><br><span class="line">      studentName : parsedJson[&#39;name&#39;],</span><br><span class="line">      studentScores : parsedJson [&#39;score&#39;]</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>在这里，我们创建了一个叫做 <code>Student.fromJson</code> 的工厂方法，用来简单地反序列化你的 json。</p>
<p><strong>我是一个小菜鸡，能告诉我反序列化究竟是什么吗？</strong></p>
<p>当然。我们首先要向你介绍序列化和反序列化。<strong>序列化</strong> 简单来讲就是把数据（可能在对象中）写成字符串，<strong>反序列化</strong> 正好相反。它获取原始数据并重建对象模型。在本文中，我们主要讨论反序列化部分。在第一部分中，我们从 <code>student.json</code> 反序列化 json 字符串。</p>
<p>所以我们的工厂方法也可以称为我们的转换器方法。</p>
<p>还必须注意 <code>fromJson</code> 方法中的参数。它是一个 <code>Map&lt;String, dynamic&gt;</code> 这意味着它将 <code>String</code> <strong>键</strong>映射为 <code>dynamic</code> <strong>值</strong>。这正是我们需要识别它结构的原因。如果这个 json 结构是一个映射列表，那么这个参数会有所不同。</p>
<p><strong>但为什么选择动态呢？</strong> 让我们先看一下另一个 json 结构来回答你的问题。</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/7/28/164e173fe5e7e9a8?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="img"></p>
<p><code>name</code> 是一个 Map&lt;String，String&gt;，<code>majors</code> 是 String 和 List 的 Map，<code>subject</code> 是 String 和 List 的 Map。</p>
<p>因为键总是一个 <code>string</code> 并且值可以是任何类型，所以我们将它保持为 <code>dynamic</code> 以保证安全。</p>
<p>在 <a href="https://github.com/PoojaB26/ParsingJSON-Flutter/blob/master/lib/model/student_model.dart" target="_blank" rel="noopener">这里</a> 检查 <code>student_model.dart</code> 的完整代码。</p>
<h3 id="访问对象"><a href="#访问对象" class="headerlink" title="访问对象"></a>访问对象</h3><p>让我们写 <code>student_services.dart</code>，它具有调用 <code>Student.fromJson</code> 的代码，能够从 <code>Student</code> 对象中获取值。</p>
<h4 id="片段-1：imports"><a href="#片段-1：imports" class="headerlink" title="片段 #1：imports"></a>片段 #1：imports</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">import &#39;dart:async&#39; show Future;</span><br><span class="line">import &#39;package:flutter&#x2F;services.dart&#39; show rootBundle;</span><br><span class="line">import &#39;dart:convert&#39;;</span><br><span class="line">import &#39;package:flutter_json&#x2F;student_model.dart&#39;;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>最后导入的是你的模型文件名。</p>
<h4 id="片段-2：加载-Json-Asset（可选）"><a href="#片段-2：加载-Json-Asset（可选）" class="headerlink" title="片段 #2：加载 Json Asset（可选）"></a><strong>片段 #2：加载 Json Asset（可选）</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Future&lt;String&gt; _loadAStudentAsset() async &#123;</span><br><span class="line">  return await rootBundle.loadString(&#39;assets&#x2F;student.json&#39;);</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>在这个特定项目中，我们的 json 文件放在 assets 文件夹下，所以我们必须这样加载 json。但如果你的 json 文件放在云端，你也可以进行网络调用。<strong>网络调用不在我们这篇文章的讨论范围内。</strong></p>
<h4 id="片段-3：加载响应"><a href="#片段-3：加载响应" class="headerlink" title="片段 #3：加载响应"></a>片段 #3：加载响应</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Future loadStudent() async &#123;</span><br><span class="line">  String jsonString &#x3D; await _loadAStudentAsset();</span><br><span class="line">  final jsonResponse &#x3D; json.decode(jsonString);</span><br><span class="line">  Student student &#x3D; new Student.fromJson(jsonResponse);</span><br><span class="line">  print(student.studentScores);</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>在 <code>loadStudent()</code> 方法中， <strong>第一行</strong>：从 assets 中加载原始 json 字符串。 <strong>第二行</strong>：解码我们得到的 json 字符串。 <strong>第三行</strong>：现在我们通过调用 <code>Student.fromJson</code> 方法反序列化解码的 json 响应，这样我们现在可以使用 <code>Student</code> 对象来访问我们的实体。 <strong>第四行</strong>：就像我们在这里做的一样，我们在 <code>Student</code> 类里打印了 <code>studentScores</code>。</p>
<p><strong>检查 Flutter 控制台以查看打印的所有值。（在 Android Studio 中，它在运行选项下）</strong></p>
<p>瞧！你刚刚完成了第一次 JSON 解析（或没有）。 <strong>注意：请记住这里的 3 个片段，我们将把它用于下一组 json 解析（只更改文件名和方法名），我不会在这里重复代码。但你可以在示例项目中找到所有内容。</strong></p>
<h3 id="JSON-结构-2：含有数组的简单结构"><a href="#JSON-结构-2：含有数组的简单结构" class="headerlink" title="JSON 结构 #2：含有数组的简单结构"></a>JSON 结构 #2：含有数组的简单结构</h3><p>现在我们要征服一个和上面那个类似的 json 结构，但不是单一值的，它可能有一个值数组。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;city&quot;: &quot;Mumbai&quot;,</span><br><span class="line">  &quot;streets&quot;: [</span><br><span class="line">    &quot;address1&quot;,</span><br><span class="line">    &quot;address2&quot;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>所以在这个 <a href="https://github.com/PoojaB26/ParsingJSON-Flutter/blob/master/assets/address.json" target="_blank" rel="noopener">address.json</a> 中，我们有一个包含简单 <code>String</code> 值的 <code>city</code> 实体，但 <code>streets</code> 是一个 <code>String</code> 数组。 就我所知，Dart 并没有数组这种数据类型，但它有 List，所以这里 <code>streets</code> 是一个 <code>List&lt;String&gt;</code>。</p>
<p>现在我们要检查一下 <strong>规则 #1 和 规则 #2</strong>。这绝对是一个 map，因为这是以花括号开头的。<code>streets</code> 仍然是一个 <code>List</code>，但我们稍后才会考虑这个。</p>
<p>所以 <code>address_model.dart</code> 一开始看起来像是这样的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">class Address &#123;</span><br><span class="line">  final String city;</span><br><span class="line">  final List&lt;String&gt; streets;</span><br><span class="line"></span><br><span class="line">  Address(&#123;</span><br><span class="line">    this.city,</span><br><span class="line">    this.streets</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>现在它是一个 map，我们的 <code>Address.fromJson</code> 方法 仍然有一个 <code>Map&lt;String, dynamic&gt;</code> 参数。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">factory Address.fromJson(Map&lt;String, dynamic&gt; parsedJson) &#123;</span><br><span class="line"></span><br><span class="line">  return new Address(</span><br><span class="line">      city: parsedJson[&#39;city&#39;],</span><br><span class="line">      streets: parsedJson[&#39;streets&#39;],</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>现在通过添加上面提到的三个代码片段来构造 <code>address_services.dart</code>。<strong>必须记住要放入正确的文件名和方法名。示例项目已经为您构建了 <code>_address_services.dart_</code>。</strong></p>
<p>如果你现在运行它，你会发现一个小错误。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">type &#39;List&lt;dynamic&gt;&#39; is not a subtype of type &#39;List&lt;String&gt;&#39;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>我告诉你，这些错误几乎在我 Dart 开发的每一步中都会出现。你也会遇到它们。那么让我解释一下这是什么意思。我们正在请求 <code>List&lt;String&gt;</code> 但我们得到一个 <code>List&lt;dynamic&gt;</code> ，因为我们的应用程序还无法识别它的类型。</p>
<p>所以我们必须把这个显式地转换成 <code>List&lt;String&gt;</code>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var streetsFromJson &#x3D; parsedJson[&#39;streets&#39;];</span><br><span class="line">List&lt;String&gt; streetsList &#x3D; new List&lt;String&gt;.from(streetsFromJson);</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>在这里，我们首先把变量映射到 <code>streetsFromJson</code> <code>streets</code> 实体。<code>streetsFromJson</code> 仍然是一个 <code>List&lt;dynamic&gt;</code>。现在我们显式地创造了一个 <code>List&lt;String&gt; streetsList</code>，它包含了 <strong>来自</strong> <code>streetsFromJson</code>的所有元素。</p>
<p>在 <a href="https://github.com/PoojaB26/ParsingJSON-Flutter/blob/master/lib/model/address_model.dart" target="_blank" rel="noopener">这里</a> 检查更新的方法。<strong>注意现在的返回语句。</strong> 现在你可以用 <code>_address_services.dart_</code> 来运行它，<strong>它会完美运行。</strong></p>
<h3 id="Json-结构-3：简单的嵌套结构"><a href="#Json-结构-3：简单的嵌套结构" class="headerlink" title="Json 结构 #3：简单的嵌套结构"></a>Json 结构 #3：简单的嵌套结构</h3><p>现在如果我们有一个像来自 <a href="https://github.com/PoojaB26/ParsingJSON-Flutter/blob/master/assets/shape.json" target="_blank" rel="noopener">shape.json</a> 的嵌套结构的话会怎样呢？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;shape_name&quot;:&quot;rectangle&quot;,</span><br><span class="line">  &quot;property&quot;:&#123;</span><br><span class="line">    &quot;width&quot;:5.0,</span><br><span class="line">    &quot;breadth&quot;:10.0</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>这里，<code>property</code> 包含一个对象而不是基本的数据类型。 <strong>那么 POOD 看起来会是怎样呢？</strong></p>
<p>好啦，让我们先休息一会。 在 <code>shape_model.dart</code> 中，让我们先为 <code>Property</code> 建一个类。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">class Property&#123;</span><br><span class="line">  double width;</span><br><span class="line">  double breadth;</span><br><span class="line"></span><br><span class="line">  Property(&#123;</span><br><span class="line">    this.width,</span><br><span class="line">    this.breadth</span><br><span class="line">&#125;);</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>现在让我们为 <code>Shape</code> 创建一个类。<strong>我将这两个类保存在同一个 Dart 文件中。</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">class Shape&#123;</span><br><span class="line">  String shapeName;</span><br><span class="line">  Property property;</span><br><span class="line"></span><br><span class="line">  Shape(&#123;</span><br><span class="line">    this.shapeName,</span><br><span class="line">    this.property</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>注意第二个数据成员 <code>property</code> 就是我们前面 <code>Property</code> 类的对象。</p>
<p><strong>规则 #3：对于嵌套结构，首先创建类和构造函数，然后从底层添加工厂方法。</strong></p>
<p><strong>在底层上，我的意思是，首先我们征服 <code>_Property_</code> 类，然后我们在 <code>_Shape_</code> 类上再上一级。当然，这只是我的个人见解，不是 Flutter 规则。</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">factory Property.fromJson(Map&lt;String, dynamic&gt; json)&#123;</span><br><span class="line">  return Property(</span><br><span class="line">    width: json[&#39;width&#39;],</span><br><span class="line">    breadth: json[&#39;breadth&#39;]</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p><strong>这是一个简单的 map。</strong></p>
<p>但是对于在 <code>Shape</code> 类中的工厂方法，我们只能这样做。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">factory Shape.fromJson(Map&lt;String, dynamic&gt; parsedJson)&#123;</span><br><span class="line">  return Shape(</span><br><span class="line">    shapeName: parsedJson[&#39;shape_name&#39;],</span><br><span class="line">    property : parsedJson[&#39;property&#39;]</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p><code>property : parsedJson[&#39;property&#39;]</code> 首先，它会抛出一个类型不匹配错误 ——</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">type &#39;_InternalLinkedHashMap&lt;String, dynamic&gt;&#39; is not a subtype of type &#39;Property&#39;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>其次，<strong>嘿，我们刚刚为 Property 做了这个优雅的类，我没有看到它在任何地方使用。</strong></p>
<p>没错，我们必须在这里映射我们的 Property 类。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">factory Shape.fromJson(Map&lt;String, dynamic&gt; parsedJson)&#123;</span><br><span class="line">  return Shape(</span><br><span class="line">    shapeName: parsedJson[&#39;shape_name&#39;],</span><br><span class="line">    property: Property.fromJson(parsedJson[&#39;property&#39;])</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>所以基本上，我们从 <code>Property</code> 类调用 <code>Property.fromJson</code> 方法，无论得到什么，我们都将它映射到 <code>property</code> 实体。简单！在 <a href="https://github.com/PoojaB26/ParsingJSON-Flutter/blob/master/lib/model/shape_model.dart" target="_blank" rel="noopener">这里</a> 检查你的代码。</p>
<p>用你的 <code>shape_services.dart</code> 运行它，你会对运行结果感到满意的。</p>
<h3 id="JSON-结构-4：含有-Lists-的嵌套结构"><a href="#JSON-结构-4：含有-Lists-的嵌套结构" class="headerlink" title="JSON 结构 #4：含有 Lists 的嵌套结构"></a>JSON 结构 #4：含有 Lists 的嵌套结构</h3><p><strong>让我们检查我们的</strong> <a href="https://github.com/PoojaB26/ParsingJSON-Flutter/blob/master/assets/product.json" target="_blank" rel="noopener"><em>product.json</em></a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;id&quot;:1,</span><br><span class="line">  &quot;name&quot;:&quot;ProductName&quot;,</span><br><span class="line">  &quot;images&quot;:[</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;id&quot;:11,</span><br><span class="line">      &quot;imageName&quot;:&quot;xCh-rhy&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;id&quot;:31,</span><br><span class="line">      &quot;imageName&quot;:&quot;fjs-eun&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>好的，现在我们越来越深入了。<strong>哇哦，我在里面看到了一个对象列表。</strong></p>
<p>是的，所以这个结构有一个对象列表，但它本身仍然是一个 map。（参考<strong>规则 #1</strong> 和 <strong>规则 #2</strong>）。现在参考 <strong>规则 #3</strong>，让我们构造我们的 <code>product_model.dart</code>。</p>
<p>现在我们来创建 <code>Product</code> 和 <code>Image</code> 这两个类。 <strong>注意：<code>_Product_</code> 会有一个数据成员，它是 <code>_Image_</code> 的 List</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">class Product &#123;</span><br><span class="line">  final int id;</span><br><span class="line">  final String name;</span><br><span class="line">  final List&lt;Image&gt; images;</span><br><span class="line"></span><br><span class="line">  Product(&#123;this.id, this.name, this.images&#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Image &#123;</span><br><span class="line">  final int imageId;</span><br><span class="line">  final String imageName;</span><br><span class="line"></span><br><span class="line">  Image(&#123;this.imageId, this.imageName&#125;);</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p><code>Image</code> 的工厂方法会非常简单和基础。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">factory Image.fromJson(Map&lt;String, dynamic&gt; parsedJson)&#123;</span><br><span class="line"> return Image(</span><br><span class="line">   imageId:parsedJson[&#39;id&#39;],</span><br><span class="line">   imageName:parsedJson[&#39;imageName&#39;]</span><br><span class="line"> );</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>这里是 <code>Product</code> 的工厂方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">factory Product.fromJson(Map&lt;String, dynamic&gt; parsedJson)&#123;</span><br><span class="line"></span><br><span class="line">  return Product(</span><br><span class="line">    id: parsedJson[&#39;id&#39;],</span><br><span class="line">    name: parsedJson[&#39;name&#39;],</span><br><span class="line">    images: parsedJson[&#39;images&#39;]</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>这里明显会抛出一个 runtime error</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">type &#39;List&lt;dynamic&gt;&#39; is not a subtype of type &#39;List&lt;Image&gt;&#39;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>如果我们这样做，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">images: Image.fromJson(parsedJson[&#39;images&#39;])</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>这也是绝对错误的，它会立即引发错误，因为你无法将 <code>Image</code> 对象分配给 <code>List&lt;Image&gt;</code>。</p>
<p>所以我们必须创建一个 <code>List&lt;Image&gt;</code> 然后将它分配给 <code>images</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var list &#x3D; parsedJson[&#39;images&#39;] as List;</span><br><span class="line">print(list.runtimeType); &#x2F;&#x2F;returns List&lt;dynamic&gt;</span><br><span class="line">List&lt;Image&gt; imagesList &#x3D; list.map((i) &#x3D;&gt; Image.fromJson(i)).toList();</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p><code>list</code> 在这里是一个 List。现在我们通过调用 <code>Image.fromJson</code> 遍历整个列表，并把 <code>list</code> 中的每个对象映射到 <code>Image</code> 中，然后我们将每个 map 对象放入一个带有 <code>toList()</code> 的新列表中，并将它存储在 <code>List&lt;Image&gt; imagesList</code>。可以在<a href="https://github.com/PoojaB26/ParsingJSON-Flutter/blob/master/lib/model/product_model.dart" target="_blank" rel="noopener">这里</a> 查看完整代码。</p>
<h3 id="JSON-结构-5：map-列表"><a href="#JSON-结构-5：map-列表" class="headerlink" title="JSON 结构 #5：map 列表"></a>JSON 结构 #5：map 列表</h3><p>现在让我们来看一下 <a href="https://github.com/PoojaB26/ParsingJSON-Flutter/blob/master/assets/photo.json" target="_blank" rel="noopener">photo.json</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    &quot;albumId&quot;: 1,</span><br><span class="line">    &quot;id&quot;: 1,</span><br><span class="line">    &quot;title&quot;: &quot;accusamus beatae ad facilis cum similique qui sunt&quot;,</span><br><span class="line">    &quot;url&quot;: &quot;http:&#x2F;&#x2F;placehold.it&#x2F;600&#x2F;92c952&quot;,</span><br><span class="line">    &quot;thumbnailUrl&quot;: &quot;http:&#x2F;&#x2F;placehold.it&#x2F;150&#x2F;92c952&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    &quot;albumId&quot;: 1,</span><br><span class="line">    &quot;id&quot;: 2,</span><br><span class="line">    &quot;title&quot;: &quot;reprehenderit est deserunt velit ipsam&quot;,</span><br><span class="line">    &quot;url&quot;: &quot;http:&#x2F;&#x2F;placehold.it&#x2F;600&#x2F;771796&quot;,</span><br><span class="line">    &quot;thumbnailUrl&quot;: &quot;http:&#x2F;&#x2F;placehold.it&#x2F;150&#x2F;771796&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    &quot;albumId&quot;: 1,</span><br><span class="line">    &quot;id&quot;: 3,</span><br><span class="line">    &quot;title&quot;: &quot;officia porro iure quia iusto qui ipsa ut modi&quot;,</span><br><span class="line">    &quot;url&quot;: &quot;http:&#x2F;&#x2F;placehold.it&#x2F;600&#x2F;24f355&quot;,</span><br><span class="line">    &quot;thumbnailUrl&quot;: &quot;http:&#x2F;&#x2F;placehold.it&#x2F;150&#x2F;24f355&quot;</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>哦，<strong>规则 #1 和 规则 #2</strong> 可以看出这不是一个 map，因为这个 json 字符串以方括号开头。<strong>所以这是一个对象列表？</strong> 是的，这里的对象是 <code>Photo</code>（或者你想称之为的任何东西）。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">class Photo&#123;</span><br><span class="line">  final String id;</span><br><span class="line">  final String title;</span><br><span class="line">  final String url;</span><br><span class="line"></span><br><span class="line">  Photo(&#123;</span><br><span class="line">    this.id,</span><br><span class="line">    this.url,</span><br><span class="line">    this.title</span><br><span class="line">&#125;) ;</span><br><span class="line"></span><br><span class="line">  factory Photo.fromJson(Map&lt;String, dynamic&gt; json)&#123;</span><br><span class="line">    return new Photo(</span><br><span class="line">      id: json[&#39;id&#39;].toString(),</span><br><span class="line">      title: json[&#39;title&#39;],</span><br><span class="line">      url: json[&#39;json&#39;],</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p><strong>但它是一个 <code>_Photo_</code> 列表，所以这意味着你必须创建一个包含 <code>_List&lt;Photo&gt;_</code> 的类？</strong></p>
<p>是的，我建议这样。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">class PhotosList &#123;</span><br><span class="line">  final List&lt;Photo&gt; photos;</span><br><span class="line"></span><br><span class="line">  PhotosList(&#123;</span><br><span class="line">    this.photos,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>同时请注意，这个 json 字符串是一个映射列表。因此，在我们的工厂方法中，不会有一个 <code>Map&lt;String, dynamic&gt;</code> 参数，因为它是一个 List。这就是为什么首先要确定结构。所以我们的新参数是 <code>List&lt;dynamic&gt;</code>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">factory PhotosList.fromJson(List&lt;dynamic&gt; parsedJson) &#123;</span><br><span class="line"></span><br><span class="line">    List&lt;Photo&gt; photos &#x3D; new List&lt;Photo&gt;();</span><br><span class="line"></span><br><span class="line">    return new PhotosList(</span><br><span class="line">       photos: photos,</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>这样会抛出一个错误。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Invalid value: Valid value range is empty: 0</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>嘿，因为我们永远不能使用 <code>Photo.fromJson</code> 方法。 如果我们在列表初始化之后添加这行代码会怎样？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">photos &#x3D; parsedJson.map((i)&#x3D;&gt;Photo.fromJson(i)).toList();</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>与前面相同的概念，我们不必把它映射到 json 字符串中的任何键，因为它是 List 而不是 map。代码在 <a href="https://github.com/PoojaB26/ParsingJSON-Flutter/blob/master/lib/model/photo_model.dart" target="_blank" rel="noopener">这里</a>.</p>
<h3 id="JSON-结构-6：复杂的嵌套结构"><a href="#JSON-结构-6：复杂的嵌套结构" class="headerlink" title="JSON 结构 #6：复杂的嵌套结构"></a>JSON 结构 #6：复杂的嵌套结构</h3><p>这是 <a href="https://github.com/PoojaB26/ParsingJSON-Flutter/blob/master/assets/page.json" target="_blank" rel="noopener">page.json</a>.</p>
<p>我会要求你解决这个问题。它已包含在示例项目中。你只需要为此构建模型和服务文件。但是在给你提示之前我不会总结（如果你需要任何提示的话）。</p>
<p><strong>规则 #1</strong> and <strong>规则 #2</strong> 一样使用。首先确定结构。这是一个 map。所以 1-5 的所有 json 结构都有用。</p>
<p><strong>规则 #3</strong> 要求你先创建类和构造函数，然后从底层添加工厂方法。不过还有一个提示，还要记得从深层/底层添加类。例如，对于这个 json 结构，首先为 <code>Image</code> 创建类，然后为 <code>Data</code> 和 <code>Author</code> 创建类，然后创建主类 <code>Page</code>。并以相同的顺序添加工厂方法。</p>
<p>对于 <code>Image</code> 和 <code>Data</code> 类，参考 <strong>Json 结构 #4</strong>。 对于 <code>Author</code> 类，参考 <strong>Json 结构 #3</strong></p>
<p><strong>给初学者的建议：在试验任何新 asset 时，请记得在 pubspec.yaml 文件中声明它。</strong></p>
<p>这就是这篇 Fluttery 文章的内容。这篇文章可能不是最好的 JSON 解析文章（因为我还在学习很多东西），但我希望它能帮助你入门。</p>
<hr>
<blockquote>
<p>我弄错了什么吗？在评论中提一下。我洗耳恭听。</p>
</blockquote>
<blockquote>
<p>如果你学到了一两件点知识，请尽可能多地拍手 👏 以表示你的支持！这会鼓励我写更多的文章。</p>
</blockquote>
<blockquote>
<p>Hello World，我是 Pooja Bhaumik。一个有创意的开发人员和理性的设计师。你可以在 <a href="https://www.linkedin.com/in/poojab26/" target="_blank" rel="noopener">Linkedin</a> 或 <a href="https://github.com/PoojaB26" target="_blank" rel="noopener">GitHub</a> 或 <a href="https://twitter.com/pblead26" target="_blank" rel="noopener">Twitter</a> 上关注我？如果这对你来说太 social 了，如果你想和我谈论对科技的想法，请发邮件到 <a href="mailto:pbhaumik26@gmail.com">pbhaumik26@gmail.com</a>。</p>
</blockquote>
<blockquote>
<p>祝你度过美好的一天！</p>
</blockquote>
<blockquote>
<p>如果发现译文存在错误或其他需要改进的地方，欢迎到 <a href="https://github.com/xitu/gold-miner" target="_blank" rel="noopener">掘金翻译计划</a> 对译文进行修改并 PR，也可获得相应奖励积分。文章开头的 <strong>本文永久链接</strong> 即为本文在 GitHub 上的 MarkDown 链接。</p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/07/17/flutter/widget%E7%BB%84%E4%BB%B6/Chip%E6%A0%87%E7%AD%BE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="冯星">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="冯星的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/07/17/flutter/widget%E7%BB%84%E4%BB%B6/Chip%E6%A0%87%E7%AD%BE/" itemprop="url">Chip标签</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-07-17T21:24:56+08:00">
                2020-07-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/flutter/" itemprop="url" rel="index">
                    <span itemprop="name">flutter</span>
                  </a>
                </span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/flutter/widget%E7%BB%84%E4%BB%B6/" itemprop="url" rel="index">
                    <span itemprop="name">widget组件</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2020/07/17/flutter/widget%E7%BB%84%E4%BB%B6/Chip%E6%A0%87%E7%AD%BE/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2020/07/17/flutter/widget%E7%BB%84%E4%BB%B6/Chip%E6%A0%87%E7%AD%BE/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>Flutter内置了多个标签类控件，但本质上它们都是同一个控件，只不过是属性参数不同而已，在学习的过程中可以将其放在放在一起学习，方便记忆。</p>
</blockquote>
<p>使用场景：食物的属性或者标签，历史搜索等。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Chip(&#123;</span><br><span class="line">    Key key,</span><br><span class="line">    this.avatar,&#x2F;&#x2F;标签左侧Widget，一般为小图标</span><br><span class="line">    @required this.label,&#x2F;&#x2F;标签</span><br><span class="line">    this.labelStyle,</span><br><span class="line">    this.labelPadding,&#x2F;&#x2F;padding</span><br><span class="line">    this.deleteIcon&#x2F;&#x2F;删除图标,</span><br><span class="line">    this.onDeleted&#x2F;&#x2F;删除回调，为空时不显示删除图标,</span><br><span class="line">    this.deleteIconColor&#x2F;&#x2F;删除图标的颜色,</span><br><span class="line">    this.deleteButtonTooltipMessage&#x2F;&#x2F;删除按钮的tip文字,</span><br><span class="line">    this.shape&#x2F;&#x2F;形状,</span><br><span class="line">    this.clipBehavior &#x3D; Clip.none,</span><br><span class="line">    this.backgroundColor&#x2F;&#x2F;背景颜色,</span><br><span class="line">    this.padding,</span><br><span class="line">    this.materialTapTargetSize&#x2F;&#x2F;删除图标material点击区域大小,</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>

<p><img src="https://upload-images.jianshu.io/upload_images/4118241-688f0e81da2cb7ed.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<h2 id="RawChip"><a href="#RawChip" class="headerlink" title="RawChip"></a>RawChip</h2><p>Material风格标签控件，此控件是其他标签控件的基类，通常情况下，不会直接创建此控件，而是使用如下控件：</p>
<ul>
<li><p>Chip</p>
</li>
<li><p>InputChip</p>
</li>
<li><p>ChoiceChip</p>
</li>
<li><p>FilterChip</p>
</li>
<li><p>ActionChip</p>
</li>
</ul>
<p>如果你想自定义标签类控件时通常使用此控件。</p>
<p>RawChip可以通过设置<code>onSelected</code>被选中，设置<code>onDeleted</code>被删除，也可以通过设置<code>onPressed</code>而像一个按钮，它有一个<code>label</code>属性，有一个前置（<code>avatar</code>）和后置图标（<code>deleteIcon</code>）。</p>
<p>基本用法如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">RawChip(</span><br><span class="line">  label: Text(&#39;老孟&#39;),</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>源码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">const RawChip(&#123;</span><br><span class="line">    Key key,</span><br><span class="line">    this.avatar,</span><br><span class="line">    @required this.label,</span><br><span class="line">    this.labelStyle,</span><br><span class="line">    this.padding,</span><br><span class="line">    this.labelPadding,</span><br><span class="line">    Widget deleteIcon,</span><br><span class="line">    this.onDeleted,</span><br><span class="line">    this.deleteIconColor,</span><br><span class="line">    this.deleteButtonTooltipMessage,</span><br><span class="line">    this.onPressed,</span><br><span class="line">    this.onSelected,</span><br><span class="line">    this.pressElevation,</span><br><span class="line">    this.tapEnabled &#x3D; true,</span><br><span class="line">    this.selected,</span><br><span class="line">    this.showCheckmark &#x3D; true,</span><br><span class="line">    this.isEnabled &#x3D; true,</span><br><span class="line">    this.disabledColor,</span><br><span class="line">    this.selectedColor,</span><br><span class="line">    this.tooltip,</span><br><span class="line">    this.shape,</span><br><span class="line">    this.clipBehavior &#x3D; Clip.none,</span><br><span class="line">    this.backgroundColor,</span><br><span class="line">    this.materialTapTargetSize,</span><br><span class="line">    this.elevation,</span><br><span class="line">    this.shadowColor,</span><br><span class="line">    this.selectedShadowColor,</span><br><span class="line">    this.avatarBorder &#x3D; const CircleBorder(),</span><br><span class="line">  &#125;) : assert(label !&#x3D; null),</span><br><span class="line">       assert(isEnabled !&#x3D; null),</span><br><span class="line">       assert(clipBehavior !&#x3D; null),</span><br><span class="line">       assert(pressElevation &#x3D;&#x3D; null || pressElevation &gt;&#x3D; 0.0),</span><br><span class="line">       assert(elevation &#x3D;&#x3D; null || elevation &gt;&#x3D; 0.0),</span><br><span class="line">       deleteIcon &#x3D; deleteIcon ?? _kDefaultDeleteIcon,</span><br><span class="line">       super(key: key);</span><br></pre></td></tr></table></figure>

<h2 id="FilterChip"><a href="#FilterChip" class="headerlink" title="FilterChip"></a>FilterChip</h2><p>FilterChip可以作为过滤标签，本质上也是一个RawChip，用法如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; _filters &#x3D; [];</span><br><span class="line"></span><br><span class="line">Column(</span><br><span class="line">  children: &lt;Widget&gt;[</span><br><span class="line">    Wrap(</span><br><span class="line">      spacing: 15,</span><br><span class="line">      children: List.generate(10, (index) &#123;</span><br><span class="line">        return FilterChip(</span><br><span class="line">          label: Text(&#39;老孟 $index&#39;),</span><br><span class="line">          selected: _filters.contains(&#39;$index&#39;),</span><br><span class="line">          onSelected: (v) &#123;</span><br><span class="line">            setState(() &#123;</span><br><span class="line">              if(v)&#123;</span><br><span class="line">                _filters.add(&#39;$index&#39;);</span><br><span class="line">              &#125;else&#123;</span><br><span class="line">                _filters.removeWhere((f)&#123;</span><br><span class="line">                  return f &#x3D;&#x3D; &#39;$index&#39;;</span><br><span class="line">                &#125;);</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">          &#125;,</span><br><span class="line">        );</span><br><span class="line">      &#125;).toList(),</span><br><span class="line">    ),</span><br><span class="line">    Text(&#39;选中：$&#123;_filters.join(&#39;,&#39;)&#125;&#39;),</span><br><span class="line">  ],</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p><img src="https://pic4.zhimg.com/v2-d162efa3acc2988e917d8c66847377bf_b.webp" alt="img"></p>
<h2 id="ChoiceChip"><a href="#ChoiceChip" class="headerlink" title="ChoiceChip"></a>ChoiceChip</h2><p>允许从一组选项中进行单个选择，创建一个类似于单选按钮的标签，本质上ChoiceChip也是一个RawChip，ChoiceChip本身不具备单选属性。</p>
<p>单选demo如下：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">int</span> _selectIndex = <span class="number">0</span>;</span><br><span class="line">Wrap(</span><br><span class="line">  spacing: <span class="number">15</span>,</span><br><span class="line">  children: <span class="built_in">List</span>.generate(<span class="number">10</span>, (index) &#123;</span><br><span class="line">    <span class="keyword">return</span> ChoiceChip(</span><br><span class="line">      label: Text(<span class="string">'老孟 <span class="subst">$index</span>'</span>),</span><br><span class="line">      selected: _selectIndex == index,</span><br><span class="line">      onSelected: (v) &#123;</span><br><span class="line">        setState(() &#123;</span><br><span class="line">          _selectIndex = index;</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;,</span><br><span class="line">    );</span><br><span class="line">  &#125;).toList(),</span><br><span class="line">)复制代码</span><br></pre></td></tr></table></figure>

<p>效果如下：</p>
<p><img src="https://user-gold-cdn.xitu.io/2020/5/10/171fc2c459eefd0c?imageslim" alt="img"></p>
<h2 id="InputChip"><a href="#InputChip" class="headerlink" title="InputChip"></a>InputChip</h2><p>以紧凑的形式表示一条复杂的信息，例如实体（人，地方或事物）或对话文本。</p>
<p>InputChip 本质上也是RawChip，用法和RawChip一样。源代码如下：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@override</span></span><br><span class="line">Widget build(BuildContext context) &#123;</span><br><span class="line">  <span class="keyword">assert</span>(debugCheckHasMaterial(context));</span><br><span class="line">  <span class="keyword">return</span> RawChip(</span><br><span class="line">    avatar: avatar,</span><br><span class="line">    label: label,</span><br><span class="line">    labelStyle: labelStyle,</span><br><span class="line">    labelPadding: labelPadding,</span><br><span class="line">    deleteIcon: deleteIcon,</span><br><span class="line">    onDeleted: onDeleted,</span><br><span class="line">    deleteIconColor: deleteIconColor,</span><br><span class="line">    deleteButtonTooltipMessage: deleteButtonTooltipMessage,</span><br><span class="line">    onSelected: onSelected,</span><br><span class="line">    onPressed: onPressed,</span><br><span class="line">    pressElevation: pressElevation,</span><br><span class="line">    selected: selected,</span><br><span class="line">    tapEnabled: <span class="keyword">true</span>,</span><br><span class="line">    disabledColor: disabledColor,</span><br><span class="line">    selectedColor: selectedColor,</span><br><span class="line">    tooltip: tooltip,</span><br><span class="line">    shape: shape,</span><br><span class="line">    clipBehavior: clipBehavior,</span><br><span class="line">    focusNode: focusNode,</span><br><span class="line">    autofocus: autofocus,</span><br><span class="line">    backgroundColor: backgroundColor,</span><br><span class="line">    padding: padding,</span><br><span class="line">    materialTapTargetSize: materialTapTargetSize,</span><br><span class="line">    elevation: elevation,</span><br><span class="line">    shadowColor: shadowColor,</span><br><span class="line">    selectedShadowColor: selectedShadowColor,</span><br><span class="line">    showCheckmark: showCheckmark,</span><br><span class="line">    checkmarkColor: checkmarkColor,</span><br><span class="line">    isEnabled: isEnabled &amp;&amp; (onSelected != <span class="keyword">null</span> || onDeleted != <span class="keyword">null</span> || onPressed != <span class="keyword">null</span>),</span><br><span class="line">    avatarBorder: avatarBorder,</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ActionChip"><a href="#ActionChip" class="headerlink" title="ActionChip"></a>ActionChip</h2><p>显示与主要内容有关的一组动作，本质上也是一个RawChip，用法如下：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ActionChip(</span><br><span class="line">    avatar: CircleAvatar(</span><br><span class="line">      backgroundColor: Colors.grey.shade800,</span><br><span class="line">      child: Text(<span class="string">'孟'</span>),</span><br><span class="line">    ),</span><br><span class="line">    label: Text(<span class="string">'老孟'</span>),</span><br><span class="line">    onPressed: () &#123;</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">"onPressed"</span>);</span><br><span class="line">    &#125;)复制代码</span><br></pre></td></tr></table></figure>

<p>效果如下：</p>
<p><img src="https://user-gold-cdn.xitu.io/2020/5/10/171fc2c4cf6d99c6?imageslim" alt="img"></p>
<p>效果很像按钮类控件。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/07/17/flutter/widget%E7%BB%84%E4%BB%B6/Wrap/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="冯星">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="冯星的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/07/17/flutter/widget%E7%BB%84%E4%BB%B6/Wrap/" itemprop="url">Wrap</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-07-17T21:19:15+08:00">
                2020-07-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/flutter/" itemprop="url" rel="index">
                    <span itemprop="name">flutter</span>
                  </a>
                </span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/flutter/widget%E7%BB%84%E4%BB%B6/" itemprop="url" rel="index">
                    <span itemprop="name">widget组件</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2020/07/17/flutter/widget%E7%BB%84%E4%BB%B6/Wrap/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2020/07/17/flutter/widget%E7%BB%84%E4%BB%B6/Wrap/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>看名字我们也能看出来，它就是一个包裹住子布局的 Widget，并且可以自动换行。</p>
<p>先看一下构造函数，来确定一下需要传入什么参数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Wrap(&#123;</span><br><span class="line">  Key key,</span><br><span class="line">  this.direction &#x3D; Axis.horizontal, &#x2F;&#x2F; 子布局排列方向</span><br><span class="line">  this.alignment &#x3D; WrapAlignment.start, &#x2F;&#x2F; 子布局对齐方向</span><br><span class="line">  this.spacing &#x3D; 0.0, &#x2F;&#x2F; 间隔</span><br><span class="line">  this.runAlignment &#x3D; WrapAlignment.start, &#x2F;&#x2F; run 可以理解为新的一行，新的一行的对齐方向</span><br><span class="line">  this.runSpacing &#x3D; 0.0, &#x2F;&#x2F; 两行的间距</span><br><span class="line">  this.crossAxisAlignment &#x3D; WrapCrossAlignment.start,</span><br><span class="line">  this.textDirection,</span><br><span class="line">  this.verticalDirection &#x3D; VerticalDirection.down,</span><br><span class="line">  List&lt;Widget&gt; children &#x3D; const &lt;Widget&gt;[],</span><br><span class="line">&#125;) : super(key: key, children: children);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>本文主要介绍Flutter布局中的Flow、Table、Wrap控件，详细介绍了其布局行为以及使用场景，并对源码进行了分析。</p>
</blockquote>
<h2 id="1-Flow"><a href="#1-Flow" class="headerlink" title="1. Flow"></a>1. Flow</h2><blockquote>
<p>A widget that implements the flow layout algorithm.</p>
</blockquote>
<h3 id="1-1-简介"><a href="#1-1-简介" class="headerlink" title="1.1 简介"></a>1.1 简介</h3><p>Flow按照解释的那样，是一个实现流式布局算法的控件。流式布局在大前端是很常见的布局方式，但是一般使用Flow很少，因为其过于复杂，很多场景下都会去使用Wrap。</p>
<h3 id="1-2-布局行为"><a href="#1-2-布局行为" class="headerlink" title="1.2 布局行为"></a>1.2 布局行为</h3><p>Flow官方介绍是一个对child尺寸以及位置调整非常高效的控件，主要是得益于其FlowDelegate。另外Flow在用转换矩阵（transformation matrices）对child进行位置调整的时候进行了优化。</p>
<p>Flow以及其child的一些约束都会受到FlowDelegate的控制，例如重写FlowDelegate中的geiSize，可以设置Flow的尺寸，重写其getConstraintsForChild方法，可以设置每个child的布局约束条件。</p>
<p>Flow之所以高效，是因为其在定位过后，如果使用FlowDelegate中的paintChildren改变child的尺寸或者位置，只是重绘，并没有实际调整其位置。</p>
<h3 id="1-3-继承关系"><a href="#1-3-继承关系" class="headerlink" title="1.3 继承关系"></a>1.3 继承关系</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Object &gt; Diagnosticable &gt; DiagnosticableTree &gt; Widget &gt; RenderObjectWidget &gt; MultiChildRenderObjectWidget &gt; Flow</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<h3 id="1-4-示例代码"><a href="#1-4-示例代码" class="headerlink" title="1.4 示例代码"></a>1.4 示例代码</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">const width &#x3D; 80.0;</span><br><span class="line">const height &#x3D; 60.0;</span><br><span class="line"></span><br><span class="line">Flow(</span><br><span class="line">  delegate: TestFlowDelegate(margin: EdgeInsets.fromLTRB(10.0, 10.0, 10.0, 10.0)),</span><br><span class="line">  children: &lt;Widget&gt;[</span><br><span class="line">    new Container(width: width, height: height, color: Colors.yellow,),</span><br><span class="line">    new Container(width: width, height: height, color: Colors.green,),</span><br><span class="line">    new Container(width: width, height: height, color: Colors.red,),</span><br><span class="line">    new Container(width: width, height: height, color: Colors.black,),</span><br><span class="line">    new Container(width: width, height: height, color: Colors.blue,),</span><br><span class="line">    new Container(width: width, height: height, color: Colors.lightGreenAccent,),</span><br><span class="line">  ],</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">class TestFlowDelegate extends FlowDelegate &#123;</span><br><span class="line">  EdgeInsets margin &#x3D; EdgeInsets.zero;</span><br><span class="line"></span><br><span class="line">  TestFlowDelegate(&#123;this.margin&#125;);</span><br><span class="line">  @override</span><br><span class="line">  void paintChildren(FlowPaintingContext context) &#123;</span><br><span class="line">    var x &#x3D; margin.left;</span><br><span class="line">    var y &#x3D; margin.top;</span><br><span class="line">    for (int i &#x3D; 0; i &lt; context.childCount; i++) &#123;</span><br><span class="line">      var w &#x3D; context.getChildSize(i).width + x + margin.right;</span><br><span class="line">      if (w &lt; context.size.width) &#123;</span><br><span class="line">        context.paintChild(i,</span><br><span class="line">            transform: new Matrix4.translationValues(</span><br><span class="line">                x, y, 0.0));</span><br><span class="line">        x &#x3D; w + margin.left;</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        x &#x3D; margin.left;</span><br><span class="line">        y +&#x3D; context.getChildSize(i).height + margin.top + margin.bottom;</span><br><span class="line">        context.paintChild(i,</span><br><span class="line">            transform: new Matrix4.translationValues(</span><br><span class="line">                x, y, 0.0));</span><br><span class="line">        x +&#x3D; context.getChildSize(i).width + margin.left + margin.right;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  @override</span><br><span class="line">  bool shouldRepaint(FlowDelegate oldDelegate) &#123;</span><br><span class="line">    return oldDelegate !&#x3D; this;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>样例其实并不复杂，FlowDelegate需要自己实现child的绘制，其实大多数时候就是位置的摆放。上面例子中，对每个child按照给定的margin值，进行排列，如果超出一行，则在下一行进行布局。</p>
<p><img src="https://upload-images.jianshu.io/upload_images/4118241-f9c3c946d32523da.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>另外，对这个例子多做一个说明，对于上述child宽度的变化，这个例子是没问题的，如果每个child的高度不同，则需要对代码进行调整，具体的调整是换行的时候，需要根据上一行的最大高度来确定下一行的起始y坐标。</p>
<h3 id="1-5-源码解析"><a href="#1-5-源码解析" class="headerlink" title="1.5 源码解析"></a>1.5 源码解析</h3><p>构造函数如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Flow(&#123;</span><br><span class="line">  Key key,</span><br><span class="line">  @required this.delegate,</span><br><span class="line">  List&lt;Widget&gt; children &#x3D; const &lt;Widget&gt;[],</span><br><span class="line">&#125;)</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<h4 id="1-5-1-属性解析"><a href="#1-5-1-属性解析" class="headerlink" title="1.5.1 属性解析"></a>1.5.1 属性解析</h4><p><strong>delegate</strong>：影响Flow具体布局的FlowDelegate。</p>
<p>其中FlowDelegate包含如下几个方法：</p>
<ul>
<li>getConstraintsForChild: 设置每个child的布局约束条件，会覆盖已有的；</li>
<li>getSize：设置Flow的尺寸；</li>
<li>paintChildren：child的绘制控制代码，可以调整尺寸位置，写起来比较的繁琐；</li>
<li>shouldRepaint：是否需要重绘；</li>
<li>shouldRelayout：是否需要重新布局。</li>
</ul>
<p>其中，我们平时使用的时候，一般会使用到paintChildren以及shouldRepaint两个方法。</p>
<h4 id="1-5-2-源码"><a href="#1-5-2-源码" class="headerlink" title="1.5.2 源码"></a>1.5.2 源码</h4><p>我们先来看一下Flow的布局代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">Size _getSize(BoxConstraints constraints) &#123;</span><br><span class="line">  assert(constraints.debugAssertIsValid());</span><br><span class="line">  return constraints.constrain(_delegate.getSize(constraints));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@override</span><br><span class="line">void performLayout() &#123;</span><br><span class="line">  size &#x3D; _getSize(constraints);</span><br><span class="line">  int i &#x3D; 0;</span><br><span class="line">  _randomAccessChildren.clear();</span><br><span class="line">  RenderBox child &#x3D; firstChild;</span><br><span class="line">  while (child !&#x3D; null) &#123;</span><br><span class="line">    _randomAccessChildren.add(child);</span><br><span class="line">    final BoxConstraints innerConstraints &#x3D; _delegate.getConstraintsForChild(i, constraints);</span><br><span class="line">    child.layout(innerConstraints, parentUsesSize: true);</span><br><span class="line">    final FlowParentData childParentData &#x3D; child.parentData;</span><br><span class="line">    childParentData.offset &#x3D; Offset.zero;</span><br><span class="line">    child &#x3D; childParentData.nextSibling;</span><br><span class="line">    i +&#x3D; 1;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>可以看到Flow尺寸的取值，直接来自于delegate的getSize方法。对于每一个child，则是将delegate中的getConstraintsForChild设置的约束条件，设置在child上。</p>
<p>Flow布局上的表现，受Delegate中getSize以及getConstraintsForChild两个方法的影响。第一个方法设置其尺寸，第二个方法设置其children的布局约束条件。</p>
<p>接下来我们来看一下其绘制方法。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">void _paintWithDelegate(PaintingContext context, Offset offset) &#123;</span><br><span class="line">  _lastPaintOrder.clear();</span><br><span class="line">  _paintingContext &#x3D; context;</span><br><span class="line">  _paintingOffset &#x3D; offset;</span><br><span class="line">  for (RenderBox child in _randomAccessChildren) &#123;</span><br><span class="line">    final FlowParentData childParentData &#x3D; child.parentData;</span><br><span class="line">    childParentData._transform &#x3D; null;</span><br><span class="line">  &#125;</span><br><span class="line">  try &#123;</span><br><span class="line">    _delegate.paintChildren(this);</span><br><span class="line">  &#125; finally &#123;</span><br><span class="line">    _paintingContext &#x3D; null;</span><br><span class="line">    _paintingOffset &#x3D; null;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>它的绘制方法非常的简单，先将上次设置的参数都初始化，然后调用delegate中的paintChildren进行绘制。在paintChildren中会调用paintChild方法去绘制每个child，我们接下来看下其代码。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">@override</span><br><span class="line">  void paintChild(int i, &#123; Matrix4 transform, double opacity &#x3D; 1.0 &#125;) &#123;</span><br><span class="line">    transform ??&#x3D; new Matrix4.identity();</span><br><span class="line">    final RenderBox child &#x3D; _randomAccessChildren[i];</span><br><span class="line">    final FlowParentData childParentData &#x3D; child.parentData;</span><br><span class="line">    _lastPaintOrder.add(i);</span><br><span class="line">    childParentData._transform &#x3D; transform;</span><br><span class="line">    </span><br><span class="line">    if (opacity &#x3D;&#x3D; 0.0)</span><br><span class="line">      return;</span><br><span class="line"></span><br><span class="line">    void painter(PaintingContext context, Offset offset) &#123;</span><br><span class="line">      context.paintChild(child, offset);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    if (opacity &#x3D;&#x3D; 1.0) &#123;</span><br><span class="line">      _paintingContext.pushTransform(needsCompositing, _paintingOffset, transform, painter);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      _paintingContext.pushOpacity(_paintingOffset, _getAlphaFromOpacity(opacity), (PaintingContext context, Offset offset) &#123;</span><br><span class="line">        context.pushTransform(needsCompositing, offset, transform, painter);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>paitChild函数首先会将transform值设在child上，然后根据opacity值，决定其绘制的表现。</p>
<ul>
<li>当opacity为0时，只是设置了transform值，这样做是为了让其响应区域跟随调整，虽然不显示出来；</li>
<li>当opacity为1的时候，只是进行Transform操作；</li>
<li>当opacity大于0小于1时，先调整其透明度，再进行Transform操作。</li>
</ul>
<p>至于其为什么高效，主要是因为它的布局函数不牵涉到child的布局，而在绘制的时候，则根据delegate中的策略，进行有效的绘制。</p>
<h3 id="1-6-使用场景"><a href="#1-6-使用场景" class="headerlink" title="1.6 使用场景"></a>1.6 使用场景</h3><p>Flow在一些定制化的流式布局中，有可用场景，但是一般写起来比较复杂，但胜在灵活性以及其高效。</p>
<h2 id="2-Table"><a href="#2-Table" class="headerlink" title="2. Table"></a>2. Table</h2><blockquote>
<p>A widget that uses the table layout algorithm for its children.</p>
</blockquote>
<h3 id="2-1-简介"><a href="#2-1-简介" class="headerlink" title="2.1 简介"></a>2.1 简介</h3><p>每一种移动端布局中都会有一种table布局，这种控件太常见了。至于其表现形式，完全可以借鉴其他移动端的，通俗点讲，就是表格。</p>
<h3 id="2-2-布局行为"><a href="#2-2-布局行为" class="headerlink" title="2.2 布局行为"></a>2.2 布局行为</h3><p>表格的每一行的高度，由其内容决定，每一列的宽度，则由columnWidths属性单独控制。</p>
<h3 id="2-3-继承关系"><a href="#2-3-继承关系" class="headerlink" title="2.3 继承关系"></a>2.3 继承关系</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Object &gt; Diagnosticable &gt; DiagnosticableTree &gt; Widget &gt; RenderObjectWidget &gt; Table</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<h3 id="2-4-示例代码"><a href="#2-4-示例代码" class="headerlink" title="2.4 示例代码"></a>2.4 示例代码</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">Table(</span><br><span class="line">  columnWidths: const &lt;int, TableColumnWidth&gt;&#123;</span><br><span class="line">    0: FixedColumnWidth(50.0),</span><br><span class="line">    1: FixedColumnWidth(100.0),</span><br><span class="line">    2: FixedColumnWidth(50.0),</span><br><span class="line">    3: FixedColumnWidth(100.0),</span><br><span class="line">  &#125;,</span><br><span class="line">  border: TableBorder.all(color: Colors.red, width: 1.0, style: BorderStyle.solid),</span><br><span class="line">  children: const &lt;TableRow&gt;[</span><br><span class="line">    TableRow(</span><br><span class="line">      children: &lt;Widget&gt;[</span><br><span class="line">        Text(&#39;A1&#39;),</span><br><span class="line">        Text(&#39;B1&#39;),</span><br><span class="line">        Text(&#39;C1&#39;),</span><br><span class="line">        Text(&#39;D1&#39;),</span><br><span class="line">      ],</span><br><span class="line">    ),</span><br><span class="line">    TableRow(</span><br><span class="line">      children: &lt;Widget&gt;[</span><br><span class="line">        Text(&#39;A2&#39;),</span><br><span class="line">        Text(&#39;B2&#39;),</span><br><span class="line">        Text(&#39;C2&#39;),</span><br><span class="line">        Text(&#39;D2&#39;),</span><br><span class="line">      ],</span><br><span class="line">    ),</span><br><span class="line">    TableRow(</span><br><span class="line">      children: &lt;Widget&gt;[</span><br><span class="line">        Text(&#39;A3&#39;),</span><br><span class="line">        Text(&#39;B3&#39;),</span><br><span class="line">        Text(&#39;C3&#39;),</span><br><span class="line">        Text(&#39;D3&#39;),</span><br><span class="line">      ],</span><br><span class="line">    ),</span><br><span class="line">  ],</span><br><span class="line">)</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>一个三行四列的表格，第一三行宽度为50，第二四行宽度为100。</p>
<p><img src="https://upload-images.jianshu.io/upload_images/4118241-30ad26c5cf40a62f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<h3 id="2-5-源码解析"><a href="#2-5-源码解析" class="headerlink" title="2.5 源码解析"></a>2.5 源码解析</h3><p>构造函数如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Table(&#123;</span><br><span class="line">  Key key,</span><br><span class="line">  this.children &#x3D; const &lt;TableRow&gt;[],</span><br><span class="line">  this.columnWidths,</span><br><span class="line">  this.defaultColumnWidth &#x3D; const FlexColumnWidth(1.0),</span><br><span class="line">  this.textDirection,</span><br><span class="line">  this.border,</span><br><span class="line">  this.defaultVerticalAlignment &#x3D; TableCellVerticalAlignment.top,</span><br><span class="line">  this.textBaseline,</span><br><span class="line">&#125;)</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<h4 id="2-5-1-属性解析"><a href="#2-5-1-属性解析" class="headerlink" title="2.5.1 属性解析"></a>2.5.1 属性解析</h4><p><strong>columnWidths</strong>：设置每一列的宽度。</p>
<p><strong>defaultColumnWidth</strong>：默认的每一列宽度值，默认情况下均分。</p>
<p><strong>textDirection</strong>：文字方向，一般无需考虑。</p>
<p><strong>border</strong>：表格边框。</p>
<p><strong>defaultVerticalAlignment</strong>：每一个cell的垂直方向的alignment。</p>
<p>总共包含5种：</p>
<ul>
<li>top：被放置在的顶部；</li>
<li>middle：垂直居中；</li>
<li>bottom：放置在底部；</li>
<li>baseline：文本baseline对齐；</li>
<li>fill：充满整个cell。</li>
</ul>
<p><strong>textBaseline</strong>：defaultVerticalAlignment为baseline的时候，会用到这个属性。</p>
<h4 id="2-5-2-源码"><a href="#2-5-2-源码" class="headerlink" title="2.5.2 源码"></a>2.5.2 源码</h4><p>我们直接来看其布局源码：</p>
<p>第一步，当行或者列为0的时候，将自身尺寸设为0x0。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">if (rows * columns &#x3D;&#x3D; 0) &#123;</span><br><span class="line">  size &#x3D; constraints.constrain(const Size(0.0, 0.0));</span><br><span class="line">  return;</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>第二步，根据textDirection值，设置方向，一般在阿拉伯语系中，一些文本都是从右往左现实的，平时使用时，不需要去考虑这个属性。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">switch (textDirection) &#123;</span><br><span class="line">  case TextDirection.rtl:</span><br><span class="line">    positions[columns - 1] &#x3D; 0.0;</span><br><span class="line">    for (int x &#x3D; columns - 2; x &gt;&#x3D; 0; x -&#x3D; 1)</span><br><span class="line">      positions[x] &#x3D; positions[x+1] + widths[x+1];</span><br><span class="line">    _columnLefts &#x3D; positions.reversed;</span><br><span class="line">    tableWidth &#x3D; positions.first + widths.first;</span><br><span class="line">    break;</span><br><span class="line">  case TextDirection.ltr:</span><br><span class="line">    positions[0] &#x3D; 0.0;</span><br><span class="line">    for (int x &#x3D; 1; x &lt; columns; x +&#x3D; 1)</span><br><span class="line">      positions[x] &#x3D; positions[x-1] + widths[x-1];</span><br><span class="line">    _columnLefts &#x3D; positions;</span><br><span class="line">    tableWidth &#x3D; positions.last + widths.last;</span><br><span class="line">    break;</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>第三步，设置每一个cell的尺寸。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">  for (int x &#x3D; 0; x &lt; columns; x +&#x3D; 1) &#123;</span><br><span class="line">    final int xy &#x3D; x + y * columns;</span><br><span class="line">    final RenderBox child &#x3D; _children[xy];</span><br><span class="line">    if (child !&#x3D; null) &#123;</span><br><span class="line">      final TableCellParentData childParentData &#x3D; child.parentData;</span><br><span class="line">      childParentData.x &#x3D; x;</span><br><span class="line">      childParentData.y &#x3D; y;</span><br><span class="line">      switch (childParentData.verticalAlignment ?? defaultVerticalAlignment) &#123;</span><br><span class="line">        case TableCellVerticalAlignment.baseline:</span><br><span class="line">          child.layout(new BoxConstraints.tightFor(width: widths[x]), parentUsesSize: true);</span><br><span class="line">          final double childBaseline &#x3D; child.getDistanceToBaseline(textBaseline, onlyReal: true);</span><br><span class="line">          if (childBaseline !&#x3D; null) &#123;</span><br><span class="line">            beforeBaselineDistance &#x3D; math.max(beforeBaselineDistance, childBaseline);</span><br><span class="line">            afterBaselineDistance &#x3D; math.max(afterBaselineDistance, child.size.height - childBaseline);</span><br><span class="line">            baselines[x] &#x3D; childBaseline;</span><br><span class="line">            haveBaseline &#x3D; true;</span><br><span class="line">          &#125; else &#123;</span><br><span class="line">            rowHeight &#x3D; math.max(rowHeight, child.size.height);</span><br><span class="line">            childParentData.offset &#x3D; new Offset(positions[x], rowTop);</span><br><span class="line">          &#125;</span><br><span class="line">          break;</span><br><span class="line">        case TableCellVerticalAlignment.top:</span><br><span class="line">        case TableCellVerticalAlignment.middle:</span><br><span class="line">        case TableCellVerticalAlignment.bottom:</span><br><span class="line">          child.layout(new BoxConstraints.tightFor(width: widths[x]), parentUsesSize: true);</span><br><span class="line">          rowHeight &#x3D; math.max(rowHeight, child.size.height);</span><br><span class="line">          break;</span><br><span class="line">        case TableCellVerticalAlignment.fill:</span><br><span class="line">          break;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>第四步，如果有baseline则进行相关设置。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">if (haveBaseline) &#123;</span><br><span class="line">  if (y &#x3D;&#x3D; 0)</span><br><span class="line">    _baselineDistance &#x3D; beforeBaselineDistance;</span><br><span class="line">    rowHeight &#x3D; math.max(rowHeight, beforeBaselineDistance + afterBaselineDistance);</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>第五步，根据alignment，调整child的位置。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">  for (int x &#x3D; 0; x &lt; columns; x +&#x3D; 1) &#123;</span><br><span class="line">    final int xy &#x3D; x + y * columns;</span><br><span class="line">    final RenderBox child &#x3D; _children[xy];</span><br><span class="line">    if (child !&#x3D; null) &#123;</span><br><span class="line">      final TableCellParentData childParentData &#x3D; child.parentData;</span><br><span class="line">      switch (childParentData.verticalAlignment ?? defaultVerticalAlignment) &#123;</span><br><span class="line">        case TableCellVerticalAlignment.baseline:</span><br><span class="line">          if (baselines[x] !&#x3D; null)</span><br><span class="line">            childParentData.offset &#x3D; new Offset(positions[x], rowTop + beforeBaselineDistance - baselines[x]);</span><br><span class="line">          break;</span><br><span class="line">        case TableCellVerticalAlignment.top:</span><br><span class="line">          childParentData.offset &#x3D; new Offset(positions[x], rowTop);</span><br><span class="line">          break;</span><br><span class="line">        case TableCellVerticalAlignment.middle:</span><br><span class="line">          childParentData.offset &#x3D; new Offset(positions[x], rowTop + (rowHeight - child.size.height) &#x2F; 2.0);</span><br><span class="line">          break;</span><br><span class="line">        case TableCellVerticalAlignment.bottom:</span><br><span class="line">          childParentData.offset &#x3D; new Offset(positions[x], rowTop + rowHeight - child.size.height);</span><br><span class="line">          break;</span><br><span class="line">        case TableCellVerticalAlignment.fill:</span><br><span class="line">          child.layout(new BoxConstraints.tightFor(width: widths[x], height: rowHeight));</span><br><span class="line">          childParentData.offset &#x3D; new Offset(positions[x], rowTop);</span><br><span class="line">          break;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>最后一步，则是根据每一行的宽度以及每一列的高度，设置Table的尺寸。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">size &#x3D; constraints.constrain(new Size(tableWidth, rowTop));</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>最后梳理一下整个的布局流程：</p>
<ul>
<li>当行或者列为0的时候，将自身尺寸设为0x0；</li>
<li>根据textDirection进行相关设置；</li>
<li>设置cell的尺寸；</li>
<li>如果设置了baseline，则进行相关设置；</li>
<li>根据alignment设置cell垂直方向的位置；</li>
<li>设置Table的尺寸。</li>
</ul>
<p>如果经常关注系列文章的读者，可能会发现，布局控件的布局流程基本上跟上述流程是相似的。</p>
<h3 id="2-6-使用场景"><a href="#2-6-使用场景" class="headerlink" title="2.6 使用场景"></a>2.6 使用场景</h3><p>在一些需要表格展示的场景中，可以使用Table控件。</p>
<h2 id="3-Wrap"><a href="#3-Wrap" class="headerlink" title="3. Wrap"></a>3. Wrap</h2><blockquote>
<p>A widget that displays its children in multiple horizontal or vertical runs.</p>
</blockquote>
<h3 id="3-1-简介"><a href="#3-1-简介" class="headerlink" title="3.1 简介"></a>3.1 简介</h3><p>看简介，其实Wrap实现的效果，Flow可以很轻松，而且可以更加灵活的实现出来。</p>
<h3 id="3-2-布局行为"><a href="#3-2-布局行为" class="headerlink" title="3.2 布局行为"></a>3.2 布局行为</h3><p>Flow可以很轻易的实现Wrap的效果，但是Wrap更多的是在使用了Flex中的一些概念，某种意义上说是跟Row、Column更加相似的。</p>
<p>单行的Wrap跟Row表现几乎一致，单列的Wrap则跟Row表现几乎一致。但Row与Column都是单行单列的，Wrap则突破了这个限制，mainAxis上空间不足时，则向crossAxis上去扩展显示。</p>
<p>从效率上讲，Flow肯定会比Wrap高，但是Wrap使用起来会方便一些。</p>
<h3 id="3-3-继承关系"><a href="#3-3-继承关系" class="headerlink" title="3.3 继承关系"></a>3.3 继承关系</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Object &gt; Diagnosticable &gt; DiagnosticableTree &gt; Widget &gt; RenderObjectWidget &gt; MultiChildRenderObjectWidget &gt; Wrap</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>从继承关系上看，Wrap与Flow都是继承自MultiChildRenderObjectWidget，Flow可以实现Wrap的效果，但是两者却是单独实现的，说明两者有很大的不同。</p>
<h3 id="3-4-示例代码"><a href="#3-4-示例代码" class="headerlink" title="3.4 示例代码"></a>3.4 示例代码</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">Wrap(</span><br><span class="line">  spacing: 8.0, &#x2F;&#x2F; gap between adjacent chips</span><br><span class="line">  runSpacing: 4.0, &#x2F;&#x2F; gap between lines</span><br><span class="line">  children: &lt;Widget&gt;[</span><br><span class="line">    Chip(</span><br><span class="line">      avatar: CircleAvatar(</span><br><span class="line">          backgroundColor: Colors.blue.shade900, child: new Text(&#39;AH&#39;, style: TextStyle(fontSize: 10.0),)),</span><br><span class="line">      label: Text(&#39;Hamilton&#39;),</span><br><span class="line">    ),</span><br><span class="line">    Chip(</span><br><span class="line">      avatar: CircleAvatar(</span><br><span class="line">          backgroundColor: Colors.blue.shade900, child: new Text(&#39;ML&#39;, style: TextStyle(fontSize: 10.0),)),</span><br><span class="line">      label: Text(&#39;Lafayette&#39;),</span><br><span class="line">    ),</span><br><span class="line">    Chip(</span><br><span class="line">      avatar: CircleAvatar(</span><br><span class="line">          backgroundColor: Colors.blue.shade900, child: new Text(&#39;HM&#39;, style: TextStyle(fontSize: 10.0),)),</span><br><span class="line">      label: Text(&#39;Mulligan&#39;),</span><br><span class="line">    ),</span><br><span class="line">    Chip(</span><br><span class="line">      avatar: CircleAvatar(</span><br><span class="line">          backgroundColor: Colors.blue.shade900, child: new Text(&#39;JL&#39;, style: TextStyle(fontSize: 10.0),)),</span><br><span class="line">      label: Text(&#39;Laurens&#39;),</span><br><span class="line">    ),</span><br><span class="line">  ],</span><br><span class="line">)</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>示例代码直接使用的官方文档上的，效果跟Flow的例子中相似。</p>
<p><img src="https://upload-images.jianshu.io/upload_images/4118241-aa1ba6cc2a6a1b9c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<h3 id="3-5-源码解析"><a href="#3-5-源码解析" class="headerlink" title="3.5 源码解析"></a>3.5 源码解析</h3><p>构造函数如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Wrap(&#123;</span><br><span class="line">  Key key,</span><br><span class="line">  this.direction &#x3D; Axis.horizontal,</span><br><span class="line">  this.alignment &#x3D; WrapAlignment.start,</span><br><span class="line">  this.spacing &#x3D; 0.0,</span><br><span class="line">  this.runAlignment &#x3D; WrapAlignment.start,</span><br><span class="line">  this.runSpacing &#x3D; 0.0,</span><br><span class="line">  this.crossAxisAlignment &#x3D; WrapCrossAlignment.start,</span><br><span class="line">  this.textDirection,</span><br><span class="line">  this.verticalDirection &#x3D; VerticalDirection.down,</span><br><span class="line">  List&lt;Widget&gt; children &#x3D; const &lt;Widget&gt;[],</span><br><span class="line">&#125;)</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<h4 id="3-5-1-属性解析"><a href="#3-5-1-属性解析" class="headerlink" title="3.5.1 属性解析"></a>3.5.1 属性解析</h4><p><strong>direction</strong>：主轴（mainAxis）的方向，默认为水平。</p>
<p><strong>alignment</strong>：主轴方向上的对齐方式，默认为start。</p>
<p><strong>spacing</strong>：主轴方向上的间距。</p>
<p><strong>runAlignment</strong>：run的对齐方式。run可以理解为新的行或者列，如果是水平方向布局的话，run可以理解为新的一行。</p>
<p><strong>runSpacing</strong>：run的间距。</p>
<p><strong>crossAxisAlignment</strong>：交叉轴（crossAxis）方向上的对齐方式。</p>
<p><strong>textDirection</strong>：文本方向。</p>
<p><strong>verticalDirection</strong>：定义了children摆放顺序，默认是down，见Flex相关属性介绍。</p>
<h4 id="3-5-2-源码"><a href="#3-5-2-源码" class="headerlink" title="3.5.2 源码"></a>3.5.2 源码</h4><p>我们来看下其布局代码。</p>
<p>第一步，如果第一个child为null，则将其设置为最小尺寸。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">RenderBox child &#x3D; firstChild;</span><br><span class="line">if (child &#x3D;&#x3D; null) &#123;</span><br><span class="line">  size &#x3D; constraints.smallest;</span><br><span class="line">  return;</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>第二步，根据direction、textDirection以及verticalDirection属性，计算出相关的mainAxis、crossAxis是否需要调整方向，以及主轴方向上的限制。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">double mainAxisLimit &#x3D; 0.0;</span><br><span class="line">bool flipMainAxis &#x3D; false;</span><br><span class="line">bool flipCrossAxis &#x3D; false;</span><br><span class="line">switch (direction) &#123;</span><br><span class="line">  case Axis.horizontal:</span><br><span class="line">    childConstraints &#x3D; new BoxConstraints(maxWidth: constraints.maxWidth);</span><br><span class="line">    mainAxisLimit &#x3D; constraints.maxWidth;</span><br><span class="line">    if (textDirection &#x3D;&#x3D; TextDirection.rtl)</span><br><span class="line">      flipMainAxis &#x3D; true;</span><br><span class="line">    if (verticalDirection &#x3D;&#x3D; VerticalDirection.up)</span><br><span class="line">      flipCrossAxis &#x3D; true;</span><br><span class="line">    break;</span><br><span class="line">  case Axis.vertical:</span><br><span class="line">    childConstraints &#x3D; new BoxConstraints(maxHeight: constraints.maxHeight);</span><br><span class="line">    mainAxisLimit &#x3D; constraints.maxHeight;</span><br><span class="line">    if (verticalDirection &#x3D;&#x3D; VerticalDirection.up)</span><br><span class="line">      flipMainAxis &#x3D; true;</span><br><span class="line">    if (textDirection &#x3D;&#x3D; TextDirection.rtl)</span><br><span class="line">      flipCrossAxis &#x3D; true;</span><br><span class="line">    break;</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>第三步，计算出主轴以及交叉轴的区域大小。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">while (child !&#x3D; null) &#123;</span><br><span class="line">  child.layout(childConstraints, parentUsesSize: true);</span><br><span class="line">  final double childMainAxisExtent &#x3D; _getMainAxisExtent(child);</span><br><span class="line">  final double childCrossAxisExtent &#x3D; _getCrossAxisExtent(child);</span><br><span class="line">  if (childCount &gt; 0 &amp;&amp; runMainAxisExtent + spacing + childMainAxisExtent &gt; mainAxisLimit) &#123;</span><br><span class="line">    mainAxisExtent &#x3D; math.max(mainAxisExtent, runMainAxisExtent);</span><br><span class="line">    crossAxisExtent +&#x3D; runCrossAxisExtent;</span><br><span class="line">    if (runMetrics.isNotEmpty)</span><br><span class="line">      crossAxisExtent +&#x3D; runSpacing;</span><br><span class="line">    runMetrics.add(new _RunMetrics(runMainAxisExtent, runCrossAxisExtent, childCount));</span><br><span class="line">    runMainAxisExtent &#x3D; 0.0;</span><br><span class="line">    runCrossAxisExtent &#x3D; 0.0;</span><br><span class="line">    childCount &#x3D; 0;</span><br><span class="line">  &#125;</span><br><span class="line">  runMainAxisExtent +&#x3D; childMainAxisExtent;</span><br><span class="line">  if (childCount &gt; 0)</span><br><span class="line">    runMainAxisExtent +&#x3D; spacing;</span><br><span class="line">  runCrossAxisExtent &#x3D; math.max(runCrossAxisExtent, childCrossAxisExtent);</span><br><span class="line">  childCount +&#x3D; 1;</span><br><span class="line">  final WrapParentData childParentData &#x3D; child.parentData;</span><br><span class="line">  childParentData._runIndex &#x3D; runMetrics.length;</span><br><span class="line">  child &#x3D; childParentData.nextSibling;</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>第四步，根据direction设置Wrap的尺寸。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">switch (direction) &#123;</span><br><span class="line">  case Axis.horizontal:</span><br><span class="line">    size &#x3D; constraints.constrain(new Size(mainAxisExtent, crossAxisExtent));</span><br><span class="line">    containerMainAxisExtent &#x3D; size.width;</span><br><span class="line">    containerCrossAxisExtent &#x3D; size.height;</span><br><span class="line">    break;</span><br><span class="line">  case Axis.vertical:</span><br><span class="line">    size &#x3D; constraints.constrain(new Size(crossAxisExtent, mainAxisExtent));</span><br><span class="line">    containerMainAxisExtent &#x3D; size.height;</span><br><span class="line">    containerCrossAxisExtent &#x3D; size.width;</span><br><span class="line">    break;</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>第五步，根据runAlignment计算出每一个run之间的距离，几种属性的差异，之前文章介绍过，在此就不做详细阐述。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">final double crossAxisFreeSpace &#x3D; math.max(0.0, containerCrossAxisExtent - crossAxisExtent);</span><br><span class="line">double runLeadingSpace &#x3D; 0.0;</span><br><span class="line">double runBetweenSpace &#x3D; 0.0;</span><br><span class="line">switch (runAlignment) &#123;</span><br><span class="line">  case WrapAlignment.start:</span><br><span class="line">    break;</span><br><span class="line">  case WrapAlignment.end:</span><br><span class="line">    runLeadingSpace &#x3D; crossAxisFreeSpace;</span><br><span class="line">    break;</span><br><span class="line">  case WrapAlignment.center:</span><br><span class="line">    runLeadingSpace &#x3D; crossAxisFreeSpace &#x2F; 2.0;</span><br><span class="line">    break;</span><br><span class="line">  case WrapAlignment.spaceBetween:</span><br><span class="line">    runBetweenSpace &#x3D; runCount &gt; 1 ? crossAxisFreeSpace &#x2F; (runCount - 1) : 0.0;</span><br><span class="line">    break;</span><br><span class="line">  case WrapAlignment.spaceAround:</span><br><span class="line">    runBetweenSpace &#x3D; crossAxisFreeSpace &#x2F; runCount;</span><br><span class="line">    runLeadingSpace &#x3D; runBetweenSpace &#x2F; 2.0;</span><br><span class="line">    break;</span><br><span class="line">  case WrapAlignment.spaceEvenly:</span><br><span class="line">    runBetweenSpace &#x3D; crossAxisFreeSpace &#x2F; (runCount + 1);</span><br><span class="line">    runLeadingSpace &#x3D; runBetweenSpace;</span><br><span class="line">    break;</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>第六步，根据alignment计算出每一个run中child的主轴方向上的间距。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">  switch (alignment) &#123;</span><br><span class="line">    case WrapAlignment.start:</span><br><span class="line">      break;</span><br><span class="line">    case WrapAlignment.end:</span><br><span class="line">      childLeadingSpace &#x3D; mainAxisFreeSpace;</span><br><span class="line">      break;</span><br><span class="line">    case WrapAlignment.center:</span><br><span class="line">      childLeadingSpace &#x3D; mainAxisFreeSpace &#x2F; 2.0;</span><br><span class="line">      break;</span><br><span class="line">    case WrapAlignment.spaceBetween:</span><br><span class="line">      childBetweenSpace &#x3D; childCount &gt; 1 ? mainAxisFreeSpace &#x2F; (childCount - 1) : 0.0;</span><br><span class="line">      break;</span><br><span class="line">    case WrapAlignment.spaceAround:</span><br><span class="line">      childBetweenSpace &#x3D; mainAxisFreeSpace &#x2F; childCount;</span><br><span class="line">      childLeadingSpace &#x3D; childBetweenSpace &#x2F; 2.0;</span><br><span class="line">      break;</span><br><span class="line">    case WrapAlignment.spaceEvenly:</span><br><span class="line">      childBetweenSpace &#x3D; mainAxisFreeSpace &#x2F; (childCount + 1);</span><br><span class="line">      childLeadingSpace &#x3D; childBetweenSpace;</span><br><span class="line">      break;</span><br><span class="line">  &#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>最后一步，调整child的位置。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">  while (child !&#x3D; null) &#123;</span><br><span class="line">    final WrapParentData childParentData &#x3D; child.parentData;</span><br><span class="line">    if (childParentData._runIndex !&#x3D; i)</span><br><span class="line">      break;</span><br><span class="line">    final double childMainAxisExtent &#x3D; _getMainAxisExtent(child);</span><br><span class="line">    final double childCrossAxisExtent &#x3D; _getCrossAxisExtent(child);</span><br><span class="line">    final double childCrossAxisOffset &#x3D; _getChildCrossAxisOffset(flipCrossAxis, runCrossAxisExtent, childCrossAxisExtent);</span><br><span class="line">    if (flipMainAxis)</span><br><span class="line">      childMainPosition -&#x3D; childMainAxisExtent;</span><br><span class="line">    childParentData.offset &#x3D; _getOffset(childMainPosition, crossAxisOffset + childCrossAxisOffset);</span><br><span class="line">    if (flipMainAxis)</span><br><span class="line">      childMainPosition -&#x3D; childBetweenSpace;</span><br><span class="line">    else</span><br><span class="line">      childMainPosition +&#x3D; childMainAxisExtent + childBetweenSpace;</span><br><span class="line">    child &#x3D; childParentData.nextSibling;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  if (flipCrossAxis)</span><br><span class="line">    crossAxisOffset -&#x3D; runBetweenSpace;</span><br><span class="line">  else</span><br><span class="line">    crossAxisOffset +&#x3D; runCrossAxisExtent + runBetweenSpace;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>我们大致梳理一下布局的流程。</p>
<ul>
<li>如果第一个child为null，则将Wrap设置为最小尺寸，布局结束；</li>
<li>根据direction、textDirection以及verticalDirection属性，计算出mainAxis、crossAxis是否需要调整方向；</li>
<li>计算出主轴以及交叉轴的区域大小；</li>
<li>根据direction设置Wrap的尺寸；</li>
<li>根据runAlignment计算出每一个run之间的距离；</li>
<li>根据alignment计算出每一个run中child的主轴方向上的间距</li>
<li>调整每一个child的位置。</li>
</ul>
<h3 id="3-6-使用场景"><a href="#3-6-使用场景" class="headerlink" title="3.6 使用场景"></a>3.6 使用场景</h3><p>对于一些需要按宽度或者高度，让child自动换行布局的场景，可以使用，但是Wrap可以满足的场景，Flow一定可以实现，只不过会复杂很多，但是相对的会灵活以及高效很多。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/07/14/flutter/widget%E7%BB%84%E4%BB%B6/%E8%BE%93%E5%85%A5%E6%A1%86TextField/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="冯星">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="冯星的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/07/14/flutter/widget%E7%BB%84%E4%BB%B6/%E8%BE%93%E5%85%A5%E6%A1%86TextField/" itemprop="url">输入框TextField</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-07-14T22:11:36+08:00">
                2020-07-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/flutter/" itemprop="url" rel="index">
                    <span itemprop="name">flutter</span>
                  </a>
                </span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/flutter/widget%E7%BB%84%E4%BB%B6/" itemprop="url" rel="index">
                    <span itemprop="name">widget组件</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2020/07/14/flutter/widget%E7%BB%84%E4%BB%B6/%E8%BE%93%E5%85%A5%E6%A1%86TextField/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2020/07/14/flutter/widget%E7%BB%84%E4%BB%B6/%E8%BE%93%E5%85%A5%E6%A1%86TextField/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">const TextField(&#123;</span><br><span class="line">  Key key,</span><br><span class="line">  TextEditingController controller,            &#x2F;&#x2F;输入框的控制器</span><br><span class="line">  FocusNode focusNode,           &#x2F;&#x2F;控制输入框是否获得焦点</span><br><span class="line">  InputDecoration decoration: const InputDecoration(),    &#x2F;&#x2F;设置输入框的外观</span><br><span class="line">  TextInputType keyboardType,          &#x2F;&#x2F;键盘类型</span><br><span class="line">  TextInputAction textInputAction,         &#x2F;&#x2F;回车按钮的类型</span><br><span class="line">  TextCapitalization textCapitalization: TextCapitalization.none,    &#x2F;&#x2F; 键盘大小写</span><br><span class="line">  TextStyle style,             &#x2F;&#x2F;文本样式</span><br><span class="line">  StrutStyle strutStyle,</span><br><span class="line">  TextAlign textAlign: TextAlign.start,     &#x2F;&#x2F;水平方向对齐方式</span><br><span class="line">  TextAlignVertical textAlignVertical,      &#x2F;&#x2F;垂直方向对齐方式</span><br><span class="line">  TextDirection textDirection,           &#x2F;&#x2F;文本书写顺序</span><br><span class="line">  bool readOnly: false,          &#x2F;&#x2F;是否只读</span><br><span class="line">  bool showCursor,        &#x2F;&#x2F;是否显示光标</span><br><span class="line">  bool autofocus: false,         &#x2F;&#x2F;是否自动获得焦点</span><br><span class="line">  bool obscureText: false,     &#x2F;&#x2F;是否隐藏正在输入的文本，内容显示为圆点</span><br><span class="line">  bool autocorrect: true,    &#x2F;&#x2F;是否自动修正</span><br><span class="line">  int maxLines: 1,        &#x2F;&#x2F;输入框的最大行数</span><br><span class="line">  int minLines,            &#x2F;&#x2F;最小行数</span><br><span class="line">  bool expands: false,    &#x2F;&#x2F;是否填充父级</span><br><span class="line">  int maxLength,             &#x2F;&#x2F;文本最大长度</span><br><span class="line">  bool maxLengthEnforced: true,          &#x2F;&#x2F;超过文本最大长度是否限制输入</span><br><span class="line">  ValueChanged&lt;String&gt; onChanged,      &#x2F;&#x2F;输入文本时的回调</span><br><span class="line">  VoidCallback onEditingComplete,          &#x2F;&#x2F;完成输入时触发（按回车）</span><br><span class="line">  ValueChanged&lt;String&gt; onSubmitted,        &#x2F;&#x2F;完成输入时触发，接收当前输入文本为参数</span><br><span class="line">  List&lt;TextInputFormatter&gt; inputFormatters,      &#x2F;&#x2F;指定输入格式</span><br><span class="line">  bool enabled,             &#x2F;&#x2F;是否可用</span><br><span class="line">  double cursorWidth: 2.0,            &#x2F;&#x2F;光标宽度</span><br><span class="line">  Radius cursorRadius,                &#x2F;&#x2F;光标圆角</span><br><span class="line">  Color cursorColor,                      &#x2F;&#x2F;光标颜色</span><br><span class="line">  Brightness keyboardAppearance,        &#x2F;&#x2F;键盘色调，只在ios上有效</span><br><span class="line">  EdgeInsets scrollPadding: const EdgeInsets.all(20.0),   &#x2F;&#x2F;当输入框获得焦点并且有一部分被滚动出屏外时，将自动滚动。</span><br><span class="line">  DragStartBehavior dragStartBehavior: DragStartBehavior.start,</span><br><span class="line">  bool enableInteractiveSelection,      &#x2F;&#x2F;是否允许选中</span><br><span class="line">  GestureTapCallback onTap,            &#x2F;&#x2F;点击回调</span><br><span class="line">  InputCounterWidgetBuilder buildCounter,</span><br><span class="line">  ScrollController scrollController,</span><br><span class="line">  ScrollPhysics scrollPhysics</span><br><span class="line">&#125;)</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>先来一个最简单的demo</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">import &#39;package:flutter&#x2F;material.dart&#39;;</span><br><span class="line"></span><br><span class="line">void main() &#x3D;&gt; runApp(MyApp());</span><br><span class="line"></span><br><span class="line">class MyApp extends StatelessWidget &#123;</span><br><span class="line">  &#x2F;&#x2F; This widget is the root of your application.</span><br><span class="line">  @override</span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    return new MaterialApp(</span><br><span class="line">        home: Scaffold(</span><br><span class="line">            body: Center(</span><br><span class="line">              child: TextField(</span><br><span class="line"></span><br><span class="line">              )</span><br><span class="line">            )</span><br><span class="line">        )</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">return TextField(</span><br><span class="line">      &#x2F;&#x2F;控制器 清楚 默认值</span><br><span class="line">      controller: _controller,</span><br><span class="line">      focusNode: widget.currentFocusNode,</span><br><span class="line">      autofocus: false,</span><br><span class="line">&#x2F;&#x2F;      maxLines: 10,</span><br><span class="line">&#x2F;&#x2F;      minLines: 4,</span><br><span class="line">      expands: false,</span><br><span class="line">      &#x2F;&#x2F;maxLength: 4,</span><br><span class="line">      keyboardType: TextInputType.text,</span><br><span class="line">      &#x2F;&#x2F;每次 输入&#x2F;删除 都回调</span><br><span class="line">      onChanged: (text) &#123;</span><br><span class="line">        print(&#39;$text&#39;);</span><br><span class="line">      &#125;,</span><br><span class="line">      &#x2F;&#x2F;每次点击都回调</span><br><span class="line">      onTap: () &#123;</span><br><span class="line">        print(&#39;onTop&#39;);</span><br><span class="line">      &#125;,</span><br><span class="line">      onEditingComplete: () &#123;</span><br><span class="line">        print(&#39;onEditingComplete&#39;);</span><br><span class="line">        FocusScope.of(context).requestFocus(widget.nextFocusNode);</span><br><span class="line">      &#125;,</span><br><span class="line">      onSubmitted: (text) &#123;</span><br><span class="line">        print(&#39;onSubmitted &#x3D; $text&#39;);</span><br><span class="line">      &#125;,</span><br><span class="line">      &#x2F;&#x2F;只读模式</span><br><span class="line">      &#x2F;&#x2F;readOnly: true,</span><br><span class="line">      &#x2F;&#x2F;装饰器</span><br><span class="line">      decoration: InputDecoration(</span><br><span class="line">        &#x2F;&#x2F;左侧 输入框前的图标</span><br><span class="line">        icon: Icon(Icons.text_fields),</span><br><span class="line">        &#x2F;&#x2F;上方文字</span><br><span class="line">        labelText: &#39;请输入你的姓名)&#39;,</span><br><span class="line">        &#x2F;&#x2F;帮助类型文字提示在输入框下方，默认为灰色</span><br><span class="line">        helperText: &#39;请输入你的真实姓名&#39;,</span><br><span class="line">        &#x2F;&#x2F;为false时，当输入框获得焦点labelText不会缩小到左上角，而是消失</span><br><span class="line">        hasFloatingPlaceholder: true,</span><br><span class="line">        hintText: &#39;这是一个提示信息这是一个提示信息这是一个提示信息这是一个提示信息这是一个提示信息&#39;,</span><br><span class="line">        &#x2F;&#x2F;错误提示，和helperText位置相同，默认为红色</span><br><span class="line">        &#x2F;&#x2F;errorText: &#39;错误信息&#39;,</span><br><span class="line">        &#x2F;&#x2F;hintText最大行数，如果文本超出这个最大行数后边会显示为...</span><br><span class="line">        hintMaxLines: 1,</span><br><span class="line">        suffixIcon: Icon(Icons.chevron_right),</span><br><span class="line">        &#x2F;&#x2F;输入框左侧图标</span><br><span class="line">        prefixIcon: Icon(Icons.skip_previous),</span><br><span class="line">        &#x2F;&#x2F;输入框内左侧图标</span><br><span class="line">        contentPadding: EdgeInsets.zero,</span><br><span class="line">        &#x2F;&#x2F;作用是在较小空间时，使组件正常渲染（包括文本垂直居中）。</span><br><span class="line">        isDense: true,</span><br><span class="line">        &#x2F;&#x2F;是否填充</span><br><span class="line">        &#x2F;&#x2F;filled: true,</span><br><span class="line">        enabled: true,</span><br><span class="line">        &#x2F;&#x2F;填充颜色</span><br><span class="line">        fillColor: Colours.Border_Color,</span><br><span class="line">        focusColor: Colours.App_Main,</span><br><span class="line">        hoverColor: Colours.App_FF_D7_D7,</span><br><span class="line">      ),</span><br><span class="line">      &#x2F;&#x2F;键盘右下方的文字如：搜索、完成、下一项</span><br><span class="line">      textInputAction: TextInputAction.next,</span><br><span class="line">      &#x2F;&#x2F;字母大写的选项 键盘必须是text的 否则无效</span><br><span class="line">      textCapitalization: TextCapitalization.sentences,</span><br><span class="line">      cursorWidth: 1,</span><br><span class="line">      &#x2F;&#x2F;光标圆角</span><br><span class="line">      &#x2F;&#x2F;cursorRadius: Radius.circular(16.0),</span><br><span class="line">      &#x2F;&#x2F;不显示光标</span><br><span class="line">      showCursor: true,</span><br><span class="line">      &#x2F;&#x2F;是否密文，一般用于密码输入。</span><br><span class="line">      obscureText: false,</span><br><span class="line">      &#x2F;&#x2F;是否自动修正输入的文本，默认为true。</span><br><span class="line">      autocorrect: false,</span><br><span class="line">      &#x2F;&#x2F;BlacklistingTextInputFormatter：黑名单</span><br><span class="line">      &#x2F;&#x2F;WhitelistingTextInputFormatter：白名单</span><br><span class="line">      inputFormatters: [</span><br><span class="line">        DecimalPlacesFormatter(decimalRange: 2),</span><br><span class="line">      ],</span><br><span class="line">      &#x2F;&#x2F;输入的文本属否允许选中，默认为true，为false时不能选中。</span><br><span class="line">      enableInteractiveSelection: false,</span><br><span class="line">    );</span><br></pre></td></tr></table></figure>



<h2 id="1、controller"><a href="#1、controller" class="headerlink" title="1、controller"></a>1、controller</h2><p>输入框文本发生改变时触发，但不限于这个功能。<br> 先看demo</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">import &#39;package:flutter&#x2F;material.dart&#39;;</span><br><span class="line"></span><br><span class="line">void main() &#x3D;&gt; runApp(MyApp());</span><br><span class="line"></span><br><span class="line">class MyApp extends StatelessWidget &#123;</span><br><span class="line">  &#x2F;&#x2F; This widget is the root of your application.</span><br><span class="line">  @override</span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    return new MaterialApp(</span><br><span class="line">        home: Scaffold(</span><br><span class="line">            body: TextFieldDemo()</span><br><span class="line">        )</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class TextFieldDemo extends StatefulWidget &#123;</span><br><span class="line">  @override</span><br><span class="line">  _TextFieldState createState() &#x3D;&gt; new _TextFieldState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class _TextFieldState extends State&lt;TextFieldDemo&gt; &#123;</span><br><span class="line">  TextEditingController _controller &#x3D; TextEditingController();</span><br><span class="line"></span><br><span class="line">  @override</span><br><span class="line">  void initState() &#123;</span><br><span class="line">    _controller.addListener(() &#123;</span><br><span class="line">      print(_controller.text);</span><br><span class="line">    &#125;);</span><br><span class="line">    super.initState();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  @override</span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    return Center(</span><br><span class="line">      child: TextField(</span><br><span class="line">        controller: _controller</span><br><span class="line">      )</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>和前几个组件类似，但不相同，不只是一个状态值，而是有一个controller，并且在initState里监听文本变化。<br> 是不是感觉和<code>onChange</code>重复了，继续往下看，除了监听文本变化，还有一些其他的功能。</p>
<h3 id="设置默认值"><a href="#设置默认值" class="headerlink" title="设置默认值"></a>设置默认值</h3><p>initState方法修改如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@override</span><br><span class="line">void initState() &#123;</span><br><span class="line">  _controller.text &#x3D; &#39;default value&#39;;      &#x2F;&#x2F;输入框的默认值</span><br><span class="line">  _controller.addListener(() &#123;</span><br><span class="line">    print(_controller.text);</span><br><span class="line">  &#125;);</span><br><span class="line">  super.initState();</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<h3 id="清空输入框"><a href="#清空输入框" class="headerlink" title="清空输入框"></a>清空输入框</h3><p>initState方法修改如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@override</span><br><span class="line">void initState() &#123;</span><br><span class="line">  _controller.text &#x3D; &#39;default value&#39;;</span><br><span class="line">  _controller.addListener(() &#123;</span><br><span class="line">    print(_controller.text);</span><br><span class="line">    _controller.clear();</span><br><span class="line">  &#125;);</span><br><span class="line">  super.initState();</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>当输入框获得焦点时，会触发<code>_controller</code>这个时候调用<code>clear</code>方法会清空输入框。</p>
<h3 id="selection"><a href="#selection" class="headerlink" title="selection"></a>selection</h3><p>将initState方法修改如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">void initState() &#123;</span><br><span class="line">  _controller.text &#x3D; &#39;default value&#39;;</span><br><span class="line">  _controller.selection &#x3D; TextSelection(</span><br><span class="line">    baseOffset: 3,</span><br><span class="line">    extentOffset: 5,</span><br><span class="line">    affinity: TextAffinity.upstream,</span><br><span class="line">    isDirectional: true</span><br><span class="line">  );</span><br><span class="line">  _controller.addListener(() &#123;</span><br><span class="line">    print(_controller.text);</span><br><span class="line">  &#125;);</span><br><span class="line">  super.initState();</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p><code>baseOffset</code>和<code>extentOffset</code>配对使用，demo中的写法为从文本中第四个和第五个字符为选中状态。<br> 另外的两个我不知道是干啥的。。。</p>
<h2 id="2、focusNode"><a href="#2、focusNode" class="headerlink" title="2、focusNode"></a>2、focusNode</h2><p>焦点控制</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line">import &#39;package:flutter&#x2F;material.dart&#39;;</span><br><span class="line"></span><br><span class="line">void main() &#x3D;&gt; runApp(MyApp());</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;&#x2F; This Widget is the main application widget.</span><br><span class="line">class MyApp extends StatelessWidget &#123;</span><br><span class="line">  static const String _title &#x3D; &#39;Flutter Code Sample&#39;;</span><br><span class="line"></span><br><span class="line">  @override</span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    return MaterialApp(</span><br><span class="line">      title: _title,</span><br><span class="line">      home: Scaffold(</span><br><span class="line">        appBar: AppBar(title: const Text(_title)),</span><br><span class="line">        body: FocusNodeDemo(),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class FocusNodeDemo extends StatefulWidget &#123;</span><br><span class="line">  @override</span><br><span class="line">  _FocusNodeState createState() &#x3D;&gt; new _FocusNodeState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class _FocusNodeState extends State&lt;FocusNodeDemo&gt; &#123;</span><br><span class="line">  FocusNode focusNode1 &#x3D; new FocusNode();</span><br><span class="line">  FocusNode focusNode2 &#x3D; new FocusNode();</span><br><span class="line">  FocusScopeNode focusScopeNode;</span><br><span class="line"></span><br><span class="line">  @override</span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    return Container (</span><br><span class="line">      child: Column(</span><br><span class="line">        children: &lt;Widget&gt;[</span><br><span class="line">          TextField(</span><br><span class="line">            &#x2F;&#x2F;关联focusNode1</span><br><span class="line">            focusNode: focusNode1,     </span><br><span class="line">          ),</span><br><span class="line">          TextField(</span><br><span class="line">             &#x2F;&#x2F;关联focusNode2</span><br><span class="line">            focusNode: focusNode2,             </span><br><span class="line">          ),</span><br><span class="line">          RaisedButton(</span><br><span class="line">            child: Text(&#39;移动焦点到1&#39;),</span><br><span class="line">            onPressed: () &#123;</span><br><span class="line">              &#x2F;&#x2F;没有输入框获得焦点时初始值为null</span><br><span class="line">              if (focusScopeNode &#x3D;&#x3D; null) &#123;</span><br><span class="line">                focusScopeNode &#x3D; FocusScope.of(context);</span><br><span class="line">              &#125;</span><br><span class="line">              &#x2F;&#x2F;focusNode1获得焦点</span><br><span class="line">              focusScopeNode.requestFocus(focusNode1);</span><br><span class="line">              &#x2F;&#x2F;focusNode1和focusNode2焦点状态</span><br><span class="line">              print(focusNode1.hasFocus);</span><br><span class="line">              print(focusNode2.hasFocus);</span><br><span class="line">            &#125;</span><br><span class="line">          ),</span><br><span class="line">          RaisedButton(</span><br><span class="line">            child: Text(&#39;移动焦点到2&#39;),</span><br><span class="line">            onPressed: () &#123;</span><br><span class="line">               &#x2F;&#x2F;没有输入框获得焦点时初始值为null</span><br><span class="line">              if (focusScopeNode &#x3D;&#x3D; null) &#123;</span><br><span class="line">                focusScopeNode &#x3D; FocusScope.of(context);</span><br><span class="line">              &#125;</span><br><span class="line">              &#x2F;&#x2F;focusNode2获得焦点</span><br><span class="line">              focusScopeNode.requestFocus(focusNode2);</span><br><span class="line">              &#x2F;&#x2F;focusNode1和focusNode2焦点状态</span><br><span class="line">              print(focusNode1.hasFocus);</span><br><span class="line">              print(focusNode2.hasFocus);</span><br><span class="line">            &#125;</span><br><span class="line">          ),</span><br><span class="line">          RaisedButton(</span><br><span class="line">            child: Text(&#39;隐藏键盘&#39;),</span><br><span class="line">            onPressed: () &#123;</span><br><span class="line">              &#x2F;&#x2F;focusNode1和focusNode2失去焦点</span><br><span class="line">              focusNode1.unfocus();</span><br><span class="line">              focusNode2.unfocus();</span><br><span class="line">            &#125;</span><br><span class="line">          ),</span><br><span class="line">          RaisedButton(</span><br><span class="line">            child: Text(&#39;焦点状态&#39;),</span><br><span class="line">            onPressed: () &#123;</span><br><span class="line">              &#x2F;&#x2F;focusNode1和focusNode2焦点状态</span><br><span class="line">              print(focusNode1.hasFocus);</span><br><span class="line">              print(focusNode2.hasFocus);</span><br><span class="line">            &#125;,</span><br><span class="line">          )</span><br><span class="line">        ]</span><br><span class="line">      )</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>



<p><img src="https://user-gold-cdn.xitu.io/2019/12/31/16f5c94807b9cc69?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="image.png"></p>
<p>输入框的焦点通过<code>FocusNode</code>和<code>focusScopeNode</code>控制，<code>focusScopeNode</code>可以通过<code>focusScope.of</code>方法来获取初始值，这个方法不会让元素获得焦点，<code>focusScopeNode.requestFocus</code>方法可以让元素获得焦点。<code>focusNode</code>还有一个<code>unFocus</code>方法，可以让输入框失去焦点，另外<code>focusNode</code>还有一个<code>hasFocus</code>属性，输入框获得焦点时为<code>true</code>，失去焦点时为<code>false</code>。</p>
<h2 id="3、decoration"><a href="#3、decoration" class="headerlink" title="3、decoration"></a>3、decoration</h2><p>先看一下constructor</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">const InputDecoration(&#123;</span><br><span class="line">  Widget icon,         &#x2F;&#x2F;输入框前的图标</span><br><span class="line">  String labelText,    &#x2F;&#x2F;与placeholder类似，当输入框获得焦点时会缩小到左上角</span><br><span class="line">  TextStyle labelStyle,   &#x2F;&#x2F;labelText的字体样式</span><br><span class="line">  String helperText,    &#x2F;&#x2F;帮助类型文字提示在输入框下方，默认为灰色</span><br><span class="line">  TextStyle helperStyle,    &#x2F;&#x2F;helperText的文字样式</span><br><span class="line">  String hintText,      &#x2F;&#x2F;相当于html里的placeholder，当设置了labelText时输入框未获得焦点时不显示，获得焦点之后labelText缩小后会显示</span><br><span class="line">  TextStyle hintStyle,    &#x2F;&#x2F;hintText文字样式</span><br><span class="line">  int hintMaxLines,      &#x2F;&#x2F;hintText最大行数，如果文本超出这个最大行数后边会显示为...</span><br><span class="line">  String errorText,      &#x2F;&#x2F;错误提示，和helperText位置相同，默认为红色</span><br><span class="line">  TextStyle errorStyle,  &#x2F;&#x2F;helperText的文字样式</span><br><span class="line">  int errorMaxLines,    &#x2F;&#x2F;errorText的最大行数，超出部分显示为...</span><br><span class="line">  bool hasFloatingPlaceholder: true,  &#x2F;&#x2F;为false时，当输入框获得焦点labelText不会缩小到左上角，而是消失</span><br><span class="line">  bool isDense,</span><br><span class="line">  EdgeInsetsGeometry contentPadding,    &#x2F;&#x2F;输入框内边距</span><br><span class="line">  Widget prefixIcon,        &#x2F;&#x2F;输入框前缀图标</span><br><span class="line">  Widget prefix,              &#x2F;&#x2F;输入框前缀</span><br><span class="line">  String prefixText,          &#x2F;&#x2F;输入框前缀文本</span><br><span class="line">  TextString prefixStyle,    &#x2F;&#x2F;前缀样式</span><br><span class="line">  Widget suffixIcon,        &#x2F;&#x2F;后缀图标</span><br><span class="line">  Widget suffix,              &#x2F;&#x2F;后缀文本</span><br><span class="line">  String suffixText,        &#x2F;&#x2F;后缀</span><br><span class="line">  TextStyle suffixStyle,    &#x2F;&#x2F;后缀样式</span><br><span class="line">  Widget counter,            &#x2F;&#x2F;输入框右下方组件</span><br><span class="line">  String counterText,        &#x2F;&#x2F;输入框右下方文本</span><br><span class="line">  TextStyle counterStyle,      &#x2F;&#x2F;右下方文本样式</span><br><span class="line">  bool filled,                  &#x2F;&#x2F;是否填充</span><br><span class="line">  Color fillColor,          &#x2F;&#x2F;填充色（相当于背景色）</span><br><span class="line">  Color focusColor,    &#x2F;&#x2F;</span><br><span class="line">  Color hoverColor,      &#x2F;&#x2F;鼠标移入的填充色</span><br><span class="line">  InputBorder errorBorder,      &#x2F;&#x2F;错误时的边框</span><br><span class="line">  InputBorder focusedBorder,    &#x2F;&#x2F;获得焦点时边框</span><br><span class="line">  InputBorder focusedErrorBorder,    &#x2F;&#x2F;错误并获得焦点时的边框</span><br><span class="line">  InputBorder disabledBorder,        &#x2F;&#x2F;禁用时的边框</span><br><span class="line">  InputBorder enabledBorder,        &#x2F;&#x2F;可用时的边框</span><br><span class="line">  InputBorder border,                &#x2F;&#x2F;边框</span><br><span class="line">  bool enabled: true,              &#x2F;&#x2F;是否可用  </span><br><span class="line">  String semanticCounterText,</span><br><span class="line">  bool alignLabelWithHint</span><br><span class="line">&#125;)</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>这里的属性都很简单，没啥细说的而且有很多都是重复的，只不过是在不同状态下和不同位置。没注释的暂时还没整明白是干啥的。</p>
<h2 id="4、keyboardType"><a href="#4、keyboardType" class="headerlink" title="4、keyboardType"></a>4、keyboardType</h2><p>输入框获得焦点时弹出键盘的类型。<br> <code>number</code>、<code>phone</code>、<code>url</code>、<code>datetime</code>、<code>multiline</code>、<code>emailAddress</code>、<code>numberWithOptions()</code>、<code>visiblePassword</code>、<code>text</code><br> 看着挺多，其实有好几个都是重复的，可能是为了语义化。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">import &#39;package:flutter&#x2F;material.dart&#39;;</span><br><span class="line"></span><br><span class="line">void main() &#x3D;&gt; runApp(MyApp());</span><br><span class="line"></span><br><span class="line">class MyApp extends StatelessWidget &#123;</span><br><span class="line">  &#x2F;&#x2F; This widget is the root of your application.</span><br><span class="line">  @override</span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    return new MaterialApp(</span><br><span class="line">      home: Scaffold(</span><br><span class="line">        body: Center(</span><br><span class="line">          child: TextField(</span><br><span class="line">            keyboardType: TextInputType.number,</span><br><span class="line">          )</span><br><span class="line">        )</span><br><span class="line">      )</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>



<p><img src="https://user-gold-cdn.xitu.io/2019/12/31/16f5c9480c5df417?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="image.png"></p>
<h2 id="5、textInputAction"><a href="#5、textInputAction" class="headerlink" title="5、textInputAction"></a>5、textInputAction</h2><p>回车按钮的类型<br> <code>continueAction</code>、<code>done</code>、<code>emergencyCall</code>、<code>go</code>、<code>join</code>、<code>newline</code>、<code>next</code>、<code>route</code>、<code>search</code>、<code>send</code>、<code>unspecified</code>、<code>none</code>、<code>previous</code><br> <code>unspecified</code>和<code>newline</code>是回车，<code>none</code>和<code>previous</code>不知道干啥，android和ios都报错不支持，其他的值是什么按钮就显示什么</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">import &#39;package:flutter&#x2F;material.dart&#39;;</span><br><span class="line"></span><br><span class="line">void main() &#x3D;&gt; runApp(MyApp());</span><br><span class="line"></span><br><span class="line">class MyApp extends StatelessWidget &#123;</span><br><span class="line">  &#x2F;&#x2F; This widget is the root of your application.</span><br><span class="line">  @override</span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    return new MaterialApp(</span><br><span class="line">      home: Scaffold(</span><br><span class="line">        body: Center(</span><br><span class="line">          child: TextField(</span><br><span class="line">            textInputAction: TextInputAction.send,</span><br><span class="line">          )</span><br><span class="line">        )</span><br><span class="line">      )</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>



<p><img src="https://user-gold-cdn.xitu.io/2019/12/31/16f5c9480caa54c7?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="image.png"></p>
<h2 id="6、textCapitalization"><a href="#6、textCapitalization" class="headerlink" title="6、textCapitalization"></a>6、textCapitalization</h2><p>配置平台键盘如何选择大写或小写键盘，只有文本键盘有效。<br> <code>none</code>：默认键盘<br> <code>characters</code>：大写键盘<br> <code>sentences</code>：第一个字母大写<br> <code>words</code>：单词首字母大写</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">import &#39;package:flutter&#x2F;material.dart&#39;;</span><br><span class="line"></span><br><span class="line">void main() &#x3D;&gt; runApp(MyApp());</span><br><span class="line"></span><br><span class="line">class MyApp extends StatelessWidget &#123;</span><br><span class="line">  &#x2F;&#x2F; This widget is the root of your application.</span><br><span class="line">  @override</span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    return new MaterialApp(</span><br><span class="line">      home: Scaffold(</span><br><span class="line">        body: Center(</span><br><span class="line">          child: TextField(</span><br><span class="line">            textCapitalization: TextCapitalization.words</span><br><span class="line">          )</span><br><span class="line">        )</span><br><span class="line">      )</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>



<p><img src="https://user-gold-cdn.xitu.io/2019/12/31/16f5c9480cc81b7b?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="image.png"></p>
<h2 id="7、style"><a href="#7、style" class="headerlink" title="7、style"></a>7、style</h2><p>文本样式，这里不说了，之前的笔记有介绍。</p>
<h2 id="8、strutStyle"><a href="#8、strutStyle" class="headerlink" title="8、strutStyle"></a>8、strutStyle</h2><p>这个也不说了，看之前的笔记<a href="https://juejin.im/post/5e096bc5e51d45583d427396" target="_blank" rel="noopener">flutter笔记（二）—–hello world和文本组件Text、TextSpan</a></p>
<h2 id="9、textAlign"><a href="#9、textAlign" class="headerlink" title="9、textAlign"></a>9、textAlign</h2><p>对齐方式<a href="https://juejin.im/post/5e096bc5e51d45583d427396" target="_blank" rel="noopener">flutter笔记（二）—–hello world和文本组件Text、TextSpan</a></p>
<h2 id="10、TextAlignVertical"><a href="#10、TextAlignVertical" class="headerlink" title="10、TextAlignVertical"></a>10、TextAlignVertical</h2><p>垂直方向的对齐方式，有三个值<br> <code>top</code>、<code>center</code>、<code>bottom</code><br> 和css的<code>vertical-align</code>一个作用</p>
<h2 id="11、textDirection"><a href="#11、textDirection" class="headerlink" title="11、textDirection"></a>11、textDirection</h2><p>文本的书写顺序，不详细介绍了看之前的笔记<a href="https://juejin.im/post/5e096bc5e51d45583d427396" target="_blank" rel="noopener">flutter笔记（二）—–hello world和文本组件Text、TextSpan</a></p>
<h2 id="12、readOnly"><a href="#12、readOnly" class="headerlink" title="12、readOnly"></a>12、readOnly</h2><p>是否只读，值为<code>boolean</code>类型，为<code>true</code>时只读，但是输入框可获得焦点。</p>
<h2 id="13、showCursor"><a href="#13、showCursor" class="headerlink" title="13、showCursor"></a>13、showCursor</h2><p>是否显示光标，值为<code>boolean</code>类型。</p>
<h2 id="14、autofocus"><a href="#14、autofocus" class="headerlink" title="14、autofocus"></a>14、autofocus</h2><p>是否自动获得焦点。</p>
<h2 id="15、obscureText"><a href="#15、obscureText" class="headerlink" title="15、obscureText"></a>15、obscureText</h2><p>是否密文，一般用于密码输入。</p>
<h2 id="16、autocorrect"><a href="#16、autocorrect" class="headerlink" title="16、autocorrect"></a>16、autocorrect</h2><p>是否自动修正输入的文本，默认为<code>true</code>。</p>
<h2 id="17、maxLines"><a href="#17、maxLines" class="headerlink" title="17、maxLines"></a>17、maxLines</h2><p>输入框的最当行数，默认为1，为<code>null</code>时不做限制。</p>
<h2 id="18、minLines"><a href="#18、minLines" class="headerlink" title="18、minLines"></a>18、minLines</h2><p>输入框最小行数，和<code>maxLines</code>同时使用，并且不能大于<code>maxLines</code>。</p>
<h2 id="19、expands"><a href="#19、expands" class="headerlink" title="19、expands"></a>19、expands</h2><p>是否调整输入框高度，以填充父级，<code>maxLines</code>和<code>minLines</code>必须为null。</p>
<h2 id="20、maxLength"><a href="#20、maxLength" class="headerlink" title="20、maxLength"></a>20、maxLength</h2><p>文本最大长度，输入框右下角有长度显示。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">import &#39;package:flutter&#x2F;material.dart&#39;;</span><br><span class="line"></span><br><span class="line">void main() &#x3D;&gt; runApp(MyApp());</span><br><span class="line"></span><br><span class="line">class MyApp extends StatelessWidget &#123;</span><br><span class="line">  &#x2F;&#x2F; This widget is the root of your application.</span><br><span class="line">  @override</span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    return new MaterialApp(</span><br><span class="line">      home: Scaffold(</span><br><span class="line">        body: Center(</span><br><span class="line">          child: TextField(</span><br><span class="line">            maxLength: 20</span><br><span class="line">          )</span><br><span class="line">        )</span><br><span class="line">      )</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>



<p><img src="https://user-gold-cdn.xitu.io/2019/12/31/16f5c94817366309?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="image.png"></p>
<h2 id="21、maxLengthEnforced"><a href="#21、maxLengthEnforced" class="headerlink" title="21、maxLengthEnforced"></a>21、maxLengthEnforced</h2><p>文本长度超过最大长度是否限制输入，为false时不禁止输入，但是输入框会变红。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">import &#39;package:flutter&#x2F;material.dart&#39;;</span><br><span class="line"></span><br><span class="line">void main() &#x3D;&gt; runApp(MyApp());</span><br><span class="line"></span><br><span class="line">class MyApp extends StatelessWidget &#123;</span><br><span class="line">  &#x2F;&#x2F; This widget is the root of your application.</span><br><span class="line">  @override</span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    return new MaterialApp(</span><br><span class="line">      home: Scaffold(</span><br><span class="line">        body: Center(</span><br><span class="line">          child: TextField(</span><br><span class="line">            maxLength: 5,</span><br><span class="line">            maxLengthEnforced: false</span><br><span class="line">          )</span><br><span class="line">        )</span><br><span class="line">      )</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>



<p><img src="https://user-gold-cdn.xitu.io/2019/12/31/16f5c9484cc4ce2a?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="image.png"></p>
<h2 id="22、onChanged"><a href="#22、onChanged" class="headerlink" title="22、onChanged"></a>22、onChanged</h2><p>文本输入回调</p>
<h2 id="23、onEditingComplete"><a href="#23、onEditingComplete" class="headerlink" title="23、onEditingComplete"></a>23、onEditingComplete</h2><p>文本输入完成时的回调，即按回车时的回调。</p>
<h2 id="24、onSubmitted"><a href="#24、onSubmitted" class="headerlink" title="24、onSubmitted"></a>24、onSubmitted</h2><p>文本输入完成的回调，当前输入的文本为参数。</p>
<h2 id="25、inputFormatters"><a href="#25、inputFormatters" class="headerlink" title="25、inputFormatters"></a>25、inputFormatters</h2><p>指定输入文本的格式，需要引入<code>package:flutter/services.dart</code>，值是<code>List</code>类型，可以有多个配置。<br> <code>BlacklistingTextInputFormatter</code>：黑名单<br> <code>WhitelistingTextInputFormatter</code>：白名单</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">import &#39;package:flutter&#x2F;material.dart&#39;;</span><br><span class="line">import &#39;package:flutter&#x2F;services.dart&#39;;</span><br><span class="line"></span><br><span class="line">void main() &#x3D;&gt; runApp(MyApp());</span><br><span class="line"></span><br><span class="line">class MyApp extends StatelessWidget &#123;</span><br><span class="line">  &#x2F;&#x2F; This widget is the root of your application.</span><br><span class="line">  @override</span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    return new MaterialApp(</span><br><span class="line">      home: Scaffold(</span><br><span class="line">        body: Center(</span><br><span class="line">          child: TextField(</span><br><span class="line">            inputFormatters: [</span><br><span class="line">              BlacklistingTextInputFormatter(RegExp(&quot;[abc]&quot;))</span><br><span class="line">            ],</span><br><span class="line">          )</span><br><span class="line">        )</span><br><span class="line">      )</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>将<code>abc</code>添加黑名单，禁止输入。</p>
<h2 id="26、enabled"><a href="#26、enabled" class="headerlink" title="26、enabled"></a>26、enabled</h2><p>是否可用，为<code>false</code>时不可用，输入框不能获得焦点。</p>
<h2 id="27、cursorWidth"><a href="#27、cursorWidth" class="headerlink" title="27、cursorWidth"></a>27、cursorWidth</h2><p>光标宽度，默认是2.0。</p>
<h2 id="28、cursorRadius"><a href="#28、cursorRadius" class="headerlink" title="28、cursorRadius"></a>28、cursorRadius</h2><p>光标圆角。</p>
<h2 id="29、cursorColor"><a href="#29、cursorColor" class="headerlink" title="29、cursorColor"></a>29、cursorColor</h2><p>光标颜色</p>
<h2 id="30、keyboardAppearance"><a href="#30、keyboardAppearance" class="headerlink" title="30、keyboardAppearance"></a>30、keyboardAppearance</h2><p>键盘色调，<code>Brightness.light</code>为亮色，<code>Brightness.dark</code>为暗，只在<code>ios</code>上有效。</p>
<h2 id="31、scrollPadding"><a href="#31、scrollPadding" class="headerlink" title="31、scrollPadding"></a>31、scrollPadding</h2><p>当输入框获得焦点，并有一部分滚动到可视区之外时，自动将输入框滚动到可视区之内。</p>
<h2 id="32、dragStartBehavior"><a href="#32、dragStartBehavior" class="headerlink" title="32、dragStartBehavior"></a>32、dragStartBehavior</h2><p>好像和拖动有关，还没整明白怎么用。</p>
<h2 id="33、enableInteractiveSelection"><a href="#33、enableInteractiveSelection" class="headerlink" title="33、enableInteractiveSelection"></a>33、enableInteractiveSelection</h2><p>输入的文本属否允许选中，默认为<code>true</code>，为<code>false</code>时不能选中。</p>
<h2 id="34、onTap"><a href="#34、onTap" class="headerlink" title="34、onTap"></a>34、onTap</h2><p>点击的回调。</p>
<h2 id="35、buildCounter"><a href="#35、buildCounter" class="headerlink" title="35、buildCounter"></a>35、buildCounter</h2><p>没看明白怎么用。</p>
<h2 id="36、scrollController-amp-scrollPhysics"><a href="#36、scrollController-amp-scrollPhysics" class="headerlink" title="36、scrollController &amp; scrollPhysics"></a>36、scrollController &amp; scrollPhysics</h2><p>这两个放一起是因为不知道怎么用，看文档<code>scrollController</code>是创建一个滚动控制器，<code>scrollPhysics</code>是对滚动的物理特性做处理，应该是可以控制滚动惯性、滚动回弹的东西。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/14/">14</a><a class="extend next" rel="next" href="/page/2/">&lt;i class&#x3D;&quot;fa fa-angle-right&quot;&gt;&lt;&#x2F;i&gt;</a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">冯星</p>
              <p class="site-description motion-element" itemprop="description">人生就像是一个马尔可夫链，你的未来取决于你当下正在做的事，而无关于过去做完的事</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/%7C%7Carchive">
              
                  <span class="site-state-item-count">134</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">36</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">60</span>
                  <span class="site-state-item-name">tags</span>
                
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">冯星</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  










  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
  
  <script type="text/javascript">
    var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item=>{
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: false,
        notify: false,
        appId: 'bbc85MrQ0qhACWJxhCKrJoAj-gzGzoHsz',
        appKey: 'fWH5REKFSsGT4TKe1lWt1ke4',
        placeholder: 'Just go go',
        avatar:'mm',
        guest_info:guest,
        pageSize:'10' || 10,
    });
  </script>



  





  

  

  

  
  

  

  

  

</body>
</html>
